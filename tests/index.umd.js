!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function e(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l(this,n)}}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}function v(){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=f(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var m=function(t){return null==t};var b=function(){this.__data__=[],this.size=0};var w=function(t,e){return t===e||t!=t&&e!=e};var x=function(t,e){for(var n=t.length;n--;)if(w(t[n][0],e))return n;return-1},P=Array.prototype.splice;var O=function(t){var e=this.__data__,n=x(e,t);return!(n<0)&&(n==e.length-1?e.pop():P.call(e,n,1),--this.size,!0)};var M=function(t){var e=this.__data__,n=x(e,t);return n<0?void 0:e[n][1]};var k=function(t){return x(this.__data__,t)>-1};var _=function(t,e){var n=this.__data__,r=x(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function C(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}C.prototype.clear=b,C.prototype.delete=O,C.prototype.get=M,C.prototype.has=k,C.prototype.set=_;var D=C;var E=function(){this.__data__=new D,this.size=0};var S=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var j=function(t){return this.__data__.get(t)};var A=function(t){return this.__data__.has(t)},z="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function B(t,e){return t(e={exports:{}},e.exports),e.exports}var N="object"==typeof z&&z&&z.Object===Object&&z,T="object"==typeof self&&self&&self.Object===Object&&self,I=N||T||Function("return this")(),R=I.Symbol,L=Object.prototype,q=L.hasOwnProperty,X=L.toString,U=R?R.toStringTag:void 0;var Y=function(t){var e=q.call(t,U),n=t[U];try{t[U]=void 0;var r=!0}catch(t){}var i=X.call(t);return r&&(e?t[U]=n:delete t[U]),i},H=Object.prototype.toString;var W=function(t){return H.call(t)},F=R?R.toStringTag:void 0;var V=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":F&&F in Object(t)?Y(t):W(t)};var $=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var G,J=function(t){if(!$(t))return!1;var e=V(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},K=I["__core-js_shared__"],Q=(G=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"";var Z=function(t){return!!Q&&Q in t},tt=Function.prototype.toString;var et=function(t){if(null!=t){try{return tt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},nt=/^\[object .+?Constructor\]$/,rt=Function.prototype,it=Object.prototype,ot=rt.toString,at=it.hasOwnProperty,st=RegExp("^"+ot.call(at).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ut=function(t){return!(!$(t)||Z(t))&&(J(t)?st:nt).test(et(t))};var ct=function(t,e){return null==t?void 0:t[e]};var lt=function(t,e){var n=ct(t,e);return ut(n)?n:void 0},ht=lt(I,"Map"),ft=lt(Object,"create");var vt=function(){this.__data__=ft?ft(null):{},this.size=0};var dt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},pt=Object.prototype.hasOwnProperty;var yt=function(t){var e=this.__data__;if(ft){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return pt.call(e,t)?e[t]:void 0},gt=Object.prototype.hasOwnProperty;var mt=function(t){var e=this.__data__;return ft?void 0!==e[t]:gt.call(e,t)};var bt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ft&&void 0===e?"__lodash_hash_undefined__":e,this};function wt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}wt.prototype.clear=vt,wt.prototype.delete=dt,wt.prototype.get=yt,wt.prototype.has=mt,wt.prototype.set=bt;var xt=wt;var Pt=function(){this.size=0,this.__data__={hash:new xt,map:new(ht||D),string:new xt}};var Ot=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Mt=function(t,e){var n=t.__data__;return Ot(e)?n["string"==typeof e?"string":"hash"]:n.map};var kt=function(t){var e=Mt(this,t).delete(t);return this.size-=e?1:0,e};var _t=function(t){return Mt(this,t).get(t)};var Ct=function(t){return Mt(this,t).has(t)};var Dt=function(t,e){var n=Mt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Et(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Et.prototype.clear=Pt,Et.prototype.delete=kt,Et.prototype.get=_t,Et.prototype.has=Ct,Et.prototype.set=Dt;var St=Et;var jt=function(t,e){var n=this.__data__;if(n instanceof D){var r=n.__data__;if(!ht||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new St(r)}return n.set(t,e),this.size=n.size,this};function At(t){var e=this.__data__=new D(t);this.size=e.size}At.prototype.clear=E,At.prototype.delete=S,At.prototype.get=j,At.prototype.has=A,At.prototype.set=jt;var zt=At,Bt=function(){try{var t=lt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Nt=function(t,e,n){"__proto__"==e&&Bt?Bt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var Tt=function(t,e,n){(void 0!==n&&!w(t[e],n)||void 0===n&&!(e in t))&&Nt(t,e,n)};var It=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}(),Rt=B((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?I.Buffer:void 0,o=i?i.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=o?o(n):new t.constructor(n);return t.copy(r),r}})),Lt=I.Uint8Array;var qt=function(t){var e=new t.constructor(t.byteLength);return new Lt(e).set(new Lt(t)),e};var Xt=function(t,e){var n=e?qt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var Ut=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},Yt=Object.create,Ht=function(){function t(){}return function(e){if(!$(e))return{};if(Yt)return Yt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var Wt=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object),Ft=Object.prototype;var Vt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ft)};var $t=function(t){return"function"!=typeof t.constructor||Vt(t)?{}:Ht(Wt(t))};var Gt=function(t){return null!=t&&"object"==typeof t};var Jt=function(t){return Gt(t)&&"[object Arguments]"==V(t)},Kt=Object.prototype,Qt=Kt.hasOwnProperty,Zt=Kt.propertyIsEnumerable,te=Jt(function(){return arguments}())?Jt:function(t){return Gt(t)&&Qt.call(t,"callee")&&!Zt.call(t,"callee")},ee=Array.isArray;var ne=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var re=function(t){return null!=t&&ne(t.length)&&!J(t)};var ie=function(t){return Gt(t)&&re(t)};var oe=function(){return!1},ae=B((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?I.Buffer:void 0,o=(i?i.isBuffer:void 0)||oe;t.exports=o})),se=Function.prototype,ue=Object.prototype,ce=se.toString,le=ue.hasOwnProperty,he=ce.call(Object);var fe=function(t){if(!Gt(t)||"[object Object]"!=V(t))return!1;var e=Wt(t);if(null===e)return!0;var n=le.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ce.call(n)==he},ve={};ve["[object Float32Array]"]=ve["[object Float64Array]"]=ve["[object Int8Array]"]=ve["[object Int16Array]"]=ve["[object Int32Array]"]=ve["[object Uint8Array]"]=ve["[object Uint8ClampedArray]"]=ve["[object Uint16Array]"]=ve["[object Uint32Array]"]=!0,ve["[object Arguments]"]=ve["[object Array]"]=ve["[object ArrayBuffer]"]=ve["[object Boolean]"]=ve["[object DataView]"]=ve["[object Date]"]=ve["[object Error]"]=ve["[object Function]"]=ve["[object Map]"]=ve["[object Number]"]=ve["[object Object]"]=ve["[object RegExp]"]=ve["[object Set]"]=ve["[object String]"]=ve["[object WeakMap]"]=!1;var de=function(t){return Gt(t)&&ne(t.length)&&!!ve[V(t)]};var pe=function(t){return function(e){return t(e)}},ye=B((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n&&N.process,o=function(){try{var t=r&&r.require&&r.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=o})),ge=ye&&ye.isTypedArray,me=ge?pe(ge):de;var be=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},we=Object.prototype.hasOwnProperty;var xe=function(t,e,n){var r=t[e];we.call(t,e)&&w(r,n)&&(void 0!==n||e in t)||Nt(t,e,n)};var Pe=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?Nt(n,s,u):xe(n,s,u)}return n};var Oe=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},Me=/^(?:0|[1-9]\d*)$/;var ke=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Me.test(t))&&t>-1&&t%1==0&&t<e},_e=Object.prototype.hasOwnProperty;var Ce=function(t,e){var n=ee(t),r=!n&&te(t),i=!n&&!r&&ae(t),o=!n&&!r&&!i&&me(t),a=n||r||i||o,s=a?Oe(t.length,String):[],u=s.length;for(var c in t)!e&&!_e.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ke(c,u))||s.push(c);return s};var De=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},Ee=Object.prototype.hasOwnProperty;var Se=function(t){if(!$(t))return De(t);var e=Vt(t),n=[];for(var r in t)("constructor"!=r||!e&&Ee.call(t,r))&&n.push(r);return n};var je=function(t){return re(t)?Ce(t,!0):Se(t)};var Ae=function(t){return Pe(t,je(t))};var ze=function(t,e,n,r,i,o,a){var s=be(t,n),u=be(e,n),c=a.get(u);if(c)Tt(t,n,c);else{var l=o?o(s,u,n+"",t,e,a):void 0,h=void 0===l;if(h){var f=ee(u),v=!f&&ae(u),d=!f&&!v&&me(u);l=u,f||v||d?ee(s)?l=s:ie(s)?l=Ut(s):v?(h=!1,l=Rt(u,!0)):d?(h=!1,l=Xt(u,!0)):l=[]:fe(u)||te(u)?(l=s,te(s)?l=Ae(s):$(s)&&!J(s)||(l=$t(u))):h=!1}h&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),Tt(t,n,l)}};var Be=function t(e,n,r,i,o){e!==n&&It(n,(function(a,s){if(o||(o=new zt),$(a))ze(e,n,s,r,t,i,o);else{var u=i?i(be(e,s),a,s+"",e,n,o):void 0;void 0===u&&(u=a),Tt(e,s,u)}}),je)};var Ne=function(t){return t};var Te=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},Ie=Math.max;var Re=function(t,e,n){return e=Ie(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=Ie(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),Te(t,this,s)}};var Le=function(t){return function(){return t}},qe=Bt?function(t,e){return Bt(t,"toString",{configurable:!0,enumerable:!1,value:Le(e),writable:!0})}:Ne,Xe=Date.now;var Ue=function(t){var e=0,n=0;return function(){var r=Xe(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(qe);var Ye=function(t,e){return Ue(Re(t,e,Ne),t+"")};var He=function(t,e,n){if(!$(n))return!1;var r=typeof e;return!!("number"==r?re(n)&&ke(e,n.length):"string"==r&&e in n)&&w(n[e],t)};var We=function(t){return Ye((function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&He(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e}))}((function(t,e,n){Be(t,e,n)})),Fe=/\s/;var Ve=function(t){for(var e=t.length;e--&&Fe.test(t.charAt(e)););return e},$e=/^\s+/;var Ge=function(t){return t?t.slice(0,Ve(t)+1).replace($e,""):t};var Je=function(t){return"symbol"==typeof t||Gt(t)&&"[object Symbol]"==V(t)},Ke=/^[-+]0x[0-9a-f]+$/i,Qe=/^0b[01]+$/i,Ze=/^0o[0-7]+$/i,tn=parseInt;var en=function(t){if("number"==typeof t)return t;if(Je(t))return NaN;if($(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=$(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ge(t);var n=Qe.test(t);return n||Ze.test(t)?tn(t.slice(2),n?2:8):Ke.test(t)?NaN:+t};var nn=function(t){return t?(t=en(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var rn=function(t){var e=nn(t),n=e%1;return e==e?n?e-n:e:0};var on=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},an=R?R.prototype:void 0,sn=an?an.toString:void 0;var un=function t(e){if("string"==typeof e)return e;if(ee(e))return on(e,t)+"";if(Je(e))return sn?sn.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n};var cn=function(t){return null==t?"":un(t)},ln=I.isFinite,hn=Math.min;var fn=function(t){var e=Math[t];return function(t,n){if(t=en(t),(n=null==n?0:hn(rn(n),292))&&ln(t)){var r=(cn(t)+"e").split("e"),i=e(r[0]+"e"+(+r[1]+n));return+((r=(cn(i)+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),vn=function(){function t(){throw n(this,t),new Error("GeometryUtil is a static util class.")}return i(t,null,[{key:"containsPoint",value:function(t,e){return!1}},{key:"isIntersect",value:function(t,e){return!1}},{key:"getLength",value:function(t,e,n,r){return Math.sqrt((n-t)*(n-t)+(r-e)*(r-e))}},{key:"calcRotateAngle",value:function(t,e,n,r){var i=t-n,o=e-r,a=i/Math.sqrt(i*i+o*o);return(o/Math.sqrt(i*i+o*o)<0?-1:1)*Math.acos(a)*180/Math.PI}}]),t}(),dn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0,0];n(this,t),o(this,"tl",new DOMPoint),o(this,"tr",new DOMPoint),o(this,"bl",new DOMPoint),o(this,"br",new DOMPoint),o(this,"center",new DOMPoint),this.tl=new DOMPoint(e[0],e[1]),this.tr=new DOMPoint(e[2],e[3]),this.bl=new DOMPoint(e[4],e[5]),this.br=new DOMPoint(e[6],e[7]),this.center=new DOMPoint(e[8],e[9])}return i(t,[{key:"clone",value:function(){var e=DOMPoint.fromPoint(this.tl),n=DOMPoint.fromPoint(this.tr),r=DOMPoint.fromPoint(this.bl),i=DOMPoint.fromPoint(this.br),o=DOMPoint.fromPoint(this.center);return new t([e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y,o.x,o.y])}},{key:"containsPoint",value:function(t){var e=this.getMinAndMaxPoint(),n=e.minX,r=e.minY,i=e.maxX,o=e.maxY;if(t.x<n||t.x>i||t.y<r||t.y>o)return!1;for(var a,s=0,u=this.getBoundingLines(),c=0;c<u.length;c++){var l=u[c];if(!(t.y>l.o.y&&t.y>l.d.y)&&!(t.y<l.o.y&&t.y<l.d.y)){if(l.o.x===l.d.x&&l.o.x>=t.x)a=l.o.x;else{var h=(l.d.y-l.o.y)/(l.d.x-l.o.x);a=l.o.x+(t.y-l.o.y)/h}a>t.x&&s++}}return 0!==s&&s%2==1}},{key:"getBoundingLines",value:function(){return[{o:DOMPoint.fromPoint(this.tl),d:DOMPoint.fromPoint(this.tr)},{o:DOMPoint.fromPoint(this.tr),d:DOMPoint.fromPoint(this.br)},{o:DOMPoint.fromPoint(this.br),d:DOMPoint.fromPoint(this.bl)},{o:DOMPoint.fromPoint(this.bl),d:DOMPoint.fromPoint(this.tl)}]}},{key:"getMinAndMaxPoint",value:function(){var t=this.tl.x,e=this.tl.y,n=this.tl.x,r=this.tl.y;return[this.tr,this.bl,this.br].forEach((function(i){i.x<t&&(t=i.x),i.x>n&&(n=i.x),i.y<e&&(e=i.y),i.y>r&&(r=i.y)})),{minX:t,minY:e,maxX:n,maxY:r}}},{key:"containsBox",value:function(t){return!1}},{key:"isIntersect",value:function(t){return!1}},{key:"transform",value:function(e){var n=DOMPoint.fromPoint(this.tl).matrixTransform(e),r=DOMPoint.fromPoint(this.tr).matrixTransform(e),i=DOMPoint.fromPoint(this.bl).matrixTransform(e),o=DOMPoint.fromPoint(this.br).matrixTransform(e),a=DOMPoint.fromPoint(this.center).matrixTransform(e);return new t([n.x,n.y,r.x,r.y,i.x,i.y,o.x,o.y,a.x,a.y])}},{key:"union",value:function(t){return null}},{key:"width",get:function(){return vn.getLength(this.br.x,this.br.y,this.bl.x,this.bl.y)}},{key:"height",get:function(){return vn.getLength(this.br.x,this.br.y,this.tr.x,this.tr.y)}},{key:"left",get:function(){return this.tl.x},set:function(t){throw new Error("Can not set left to ICEBoundingBox directly.")}},{key:"top",get:function(){return this.tl.y},set:function(t){throw new Error("Can not set top to ICEBoundingBox directly.")}},{key:"centerX",get:function(){return this.center.x}},{key:"centerY",get:function(){return this.center.y}},{key:"centerPoint",get:function(){return this.center}}],[{key:"fromDimension",value:function(e,n,r,i){return new t([].concat([e,n],[e+r,n],[e,n+i],[e+r,n+i],[e+r/2,n+i/2]))}}]),t}(),pn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yn=/^\w*$/;var gn=function(t,e){if(ee(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Je(t))||(yn.test(t)||!pn.test(t)||null!=e&&t in Object(e))};function mn(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(mn.Cache||St),n}mn.Cache=St;var bn=mn;var wn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xn=/\\(\\)?/g,Pn=function(t){var e=bn(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(wn,(function(t,n,r,i){e.push(r?i.replace(xn,"$1"):n||t)})),e}));var On=function(t,e){return ee(t)?t:gn(t,e)?[t]:Pn(cn(t))};var Mn=function(t){if("string"==typeof t||Je(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var kn=function(t,e){for(var n=0,r=(e=On(e,t)).length;null!=t&&n<r;)t=t[Mn(e[n++])];return n&&n==r?t:void 0};var _n=function(t,e,n){var r=null==t?void 0:kn(t,e);return void 0===r?n:r},Cn=window||global,Dn=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var i in n(this,t),o(this,"originalEvent",void 0),o(this,"target",void 0),e)this[i]=e[i];for(var a in r)this[a]=r[a]},En=function(){function t(){n(this,t),o(this,"listeners",{}),o(this,"suspendedEventNames",[])}return i(t,[{key:"on",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cn;this.listeners[t]||(this.listeners[t]=[]),this.off(t,e,n),this.listeners[t].push({callback:e,scope:n})}},{key:"off",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cn,r=this.listeners[t];if(r)for(var i=0;i<r.length;i++){var o=r[i];if(o.callback===e&&o.scope===n)return void this.listeners[t].splice(i,1)}}},{key:"once",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cn;this.on(t,(function(r,i){n.off(t,e,i),e.call(i,r)}),r)}},{key:"trigger",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!!this.listeners[t]&&(!this.suspendedEventNames.includes(t)&&(n?(e=new Dn(n)).originalEvent=n:e=new Dn({type:t,timeStamp:(new Date).getTime()}),this.listeners[t].forEach((function(t){var n=t.callback,r=t.scope;n.call(r,e)})),!0))}},{key:"suspend",value:function(t,e){t&&!this.suspendedEventNames.includes(t)&&this.suspendedEventNames.push(t),e&&(e.prototype.suspended=!0)}},{key:"resume",value:function(t,e){t&&this.suspendedEventNames.includes(t)&&this.suspendedEventNames.splice(this.suspendedEventNames.findIndex(t),1),e&&(e.prototype.suspended=!1)}},{key:"purge",value:function(){this.listeners={}}}]),t}();En.prototype.addEventListener=En.prototype.on,En.prototype.removeEventListener=En.prototype.off,En.prototype.dispatchEvent=En.prototype.trigger;var Sn=function(){function t(){n(this,t)}return i(t,null,[{key:"calcRotateAngle",value:function(t){var e=0,n=t.a,r=t.b,i=r/Math.sqrt(n*n+r*r),o=n/Math.sqrt(n*n+r*r);return e=Math.acos(o),i<0&&(e+=Math.PI/2),e*(180/Math.PI)}},{key:"calcScale",value:function(t){return[Math.sqrt(t.a*t.a+t.b*t.b)/t.a,Math.sqrt(t.c*t.c+t.d*t.d)/t.d]}}]),t}(),jn="ICE_FRAME_EVENT",An="BEFORE_RENDER",zn="AFTER_RENDER",Bn=function(t){a(s,t);var r=h(s);function s(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,s),o(c(t=r.call(this)),"root",null),o(c(t),"ctx",null),o(c(t),"parentNode",null),o(c(t),"isRendering",!1),o(c(t),"props",{id:"ICE_"+Math.floor(1e10*Math.random()),left:0,top:0,width:0,height:0,style:{fillStyle:"red",strokeStyle:"blue",lineWidth:1},animations:{},transform:{translate:[0,0],scale:[1,1],skew:[0,0],rotate:0},translationMatrix:new DOMMatrix,linearMatrix:new DOMMatrix,composedMatrix:new DOMMatrix,origin:"localCenter",localOrigin:new DOMPoint(0,0),absoluteOrigin:new DOMPoint(0,0),zIndex:s.instanceCounter++,draggable:!0,selectable:!0,interactive:!0}),o(c(t),"state",e({},t.props)),t.props=We(t.props,i),t.state=JSON.parse(JSON.stringify(t.props)),t}return i(s,[{key:"render",value:function(){this.isRendering=!0,this.trigger(An),this.applyStyle(),this.calcOriginalDimension(),this.applyTransformToCtx(),this.doRender(),this.ctx.setTransform(new DOMMatrix),this.trigger(zn),this.isRendering=!1}},{key:"applyStyle",value:function(){Object.assign(this.ctx,e(e({},this.props.style),this.state.style))}},{key:"calcOriginalDimension",value:function(){return{width:this.state.width,height:this.state.height}}},{key:"calcLocalOrigin",value:function(){var t=new DOMPoint(0,0),e=this.state.origin;if(!e||"localCenter"===e){var n=this.state.width/2,r=this.state.height/2;t.x=n,t.y=r}return this.state.localOrigin=t,t}},{key:"calcAbsoluteOrigin",value:function(){var t=_n(this,"state.transform.translate.0")+this.state.left,e=_n(this,"state.transform.translate.1")+this.state.top,n=DOMPoint.fromPoint(this.calcLocalOrigin());if(n.x+=t,n.y+=e,this.parentNode){var r=this.parentNode.state.localOrigin.x,i=this.parentNode.state.localOrigin.y;n=n.matrixTransform(new DOMMatrix([1,0,0,1,-r,-i]));var o=this.parentNode.state.composedMatrix;n=n.matrixTransform(o)}return this.state.absoluteOrigin=n,n}},{key:"calcLinearMatrix",value:function(){var t=new DOMMatrix,e=_n(this,"state.transform.skew.0"),n=_n(this,"state.transform.skew.1");t.skewXSelf(e),t.skewYSelf(n);var r=_n(this,"state.transform.rotate");t.rotateSelf(r);var i=_n(this,"state.transform.scale.0"),o=_n(this,"state.transform.scale.1");return t.scaleSelf(i,o),this.state.linearMatrix=t,t}},{key:"calcAbsoluteLinearMatrix",value:function(){for(var t=this,e=DOMMatrix.fromMatrix(t.calcLinearMatrix());t.parentNode;)e.multiplySelf(t.parentNode.state.linearMatrix),t=t.parentNode;return this.state.absoluteLinearMatrix=DOMMatrix.fromMatrix(e),e}},{key:"composeMatrix",value:function(){var t=this.calcAbsoluteOrigin(),e=new DOMMatrix([1,0,0,1,t.x,t.y]),n=this.calcAbsoluteLinearMatrix(),r=e.multiplySelf(n);return this.state.composedMatrix=DOMMatrix.fromMatrix(r),r}},{key:"applyTransformToCtx",value:function(){this.ctx.setTransform(this.composeMatrix())}},{key:"doRender",value:function(){var t=this.getMinBoundingBox();this.ctx.setTransform(new DOMMatrix),this.ctx.lineWidth=1,this.ctx.strokeStyle="#ff0000",this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.beginPath(),this.ctx.moveTo(t.tl.x,t.tl.y),this.ctx.lineTo(t.tr.x,t.tr.y),this.ctx.lineTo(t.br.x,t.br.y),this.ctx.lineTo(t.bl.x,t.bl.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill();var e=this.getMaxBoundingBox();this.ctx.setTransform(new DOMMatrix),this.ctx.lineWidth=1,this.ctx.strokeStyle="#0000ff",this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.beginPath(),this.ctx.moveTo(e.tl.x,e.tl.y),this.ctx.lineTo(e.tr.x,e.tr.y),this.ctx.lineTo(e.br.x,e.br.y),this.ctx.lineTo(e.bl.x,e.bl.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill()}},{key:"getMinBoundingBox",value:function(){var t=this.state.localOrigin.x,e=this.state.localOrigin.y,n=this.state.width,r=this.state.height,i=new dn([0-t,0-e,0-t+n,0-e,0-t,0-e+r,0-t+n,0-e+r,0,0]);return i=i.transform(this.state.composedMatrix)}},{key:"getMaxBoundingBox",value:function(){var t=this.getMinBoundingBox(),e=t.getMinAndMaxPoint(),n=e.minX,r=e.minY,i=e.maxX,o=e.maxY,a=t.centerPoint;return t=new dn([n,r,i,r,n,o,i,o,a.x,a.y])}},{key:"setState",value:function(t){We(this.state,t)}},{key:"setPosition",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Dn;this.trigger("before-move",e(e({},r),{},{left:t,top:n})),this.setState({left:t,top:n}),this.trigger("after-move",e(e({},r),{},{left:t,top:n}))}},{key:"moveGlobalPosition",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Dn;if(this.parentNode){var i=new DOMPoint(t,n),o=this.parentNode.state.absoluteLinearMatrix.inverse();t=(i=i.matrixTransform(o)).x,n=i.y}this.setPosition(this.state.left+t,this.state.top+n,e(e({},r),{},{tx:t,ty:n}))}},{key:"setGlobalRotate",value:function(t){if(this.parentNode){var e=this.parentNode.state.absoluteLinearMatrix;t-=Sn.calcRotateAngle(e)}this.setState({transform:{rotate:t}})}},{key:"localCoordToGlobal",value:function(t,e){var n=new DOMPoint(t,e),r=this.state.composedMatrix;return n=n.matrixTransform(r)}},{key:"globalCoordToLocal",value:function(t,e){var n=new DOMPoint(t,e),r=this.state.composedMatrix.inverse();return n=n.matrixTransform(r)}},{key:"getRotateAngle",value:function(){var t=this.state.composedMatrix;return Sn.calcRotateAngle(t)}},{key:"getLocalLeftTop",value:function(){var t=this.getMinBoundingBox(),e=t.width,n=t.height;return{left:t.centerX-t.width/2,top:t.centerY-t.height/2,width:e,height:n}}},{key:"toJSON",value:function(){return"{}"}},{key:"fromJSON",value:function(t){return{}}}]),s}(En);o(Bn,"instanceCounter",0);var Nn=function(t){a(r,t);var e=h(r);function r(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),o(c(t=e.call(this,i)),"path2D",new Path2D),t}return i(r,[{key:"doRender",value:function(){this.createPathObject(),this.ctx.beginPath(),this.ctx.fill(this.path2D),this.ctx.stroke(this.path2D),v(s(r.prototype),"doRender",this).call(this)}}]),r}(Bn),Tn=function(t){a(o,t);var r=h(o);function o(t){return n(this,o),r.call(this,e({dots:[]},t))}return i(o,[{key:"calcOriginalDimension",value:function(){this.calcDots();var t=this.calc4VertexPoints(),e=Math.abs(t[1].x-t[0].x),n=Math.abs(t[2].y-t[0].y);return this.state.width=e,this.state.height=n,{width:this.state.width,height:this.state.height}}},{key:"calcLocalOrigin",value:function(){for(var t=v(s(o.prototype),"calcLocalOrigin",this).call(this),e=0;e<this.state.dots.length;e++){var n=this.state.dots[e];n=n.matrixTransform(new DOMMatrix([1,0,0,1,-t.x,-t.y])),this.state.dots[e]=n}return t}},{key:"createPathObject",value:function(){this.path2D=new Path2D;for(var t=0;t<this.state.dots.length;t++){var e=this.state.dots[t];0===t?this.path2D.moveTo(e.x,e.y):this.path2D.lineTo(e.x,e.y)}return this.path2D.closePath(),this.path2D}},{key:"calcDots",value:function(){return this.state.dots=[],this.state.dots}},{key:"calc4VertexPoints",value:function(){for(var t=0,e=0,n=0,r=0,i=0;i<this.state.dots.length;i++){var o=this.state.dots[i];0===i?(t=o.x,n=o.x,e=o.y,r=o.y):(o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<e&&(e=o.y),o.y>r&&(r=o.y))}var a=n,s=e,u=t,c=r,l=n,h=r;return[new DOMPoint(t,e),new DOMPoint(a,s),new DOMPoint(u,c),new DOMPoint(l,h)]}}]),o}(Nn),In=function(t){a(r,t);var e=h(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,r);var i=We({lineType:"solid",arrow:"none",startPoint:[0,0],endPoint:[10,10]},t);return i=We(i,{left:t.startPoint[0],top:t.startPoint[1],transform:{translate:[0,0]}}),(m(i.style.lineWidth)||i.style.lineWidth<=0)&&(i.style.lineWidth=2),e.call(this,i)}return i(r,[{key:"calcLocalOrigin",value:function(){var t=new DOMPoint(0,0);return this.state.localOrigin=t,t}},{key:"calcDots",value:function(){return this.state.dots=[new DOMPoint(0,0),new DOMPoint(this.state.endPoint[0]-this.state.startPoint[0],this.state.endPoint[1]-this.state.startPoint[1])],this.state.dots}},{key:"calcOriginalDimension",value:function(){this.calcDots();var t=this.state.startPoint[0],e=this.state.endPoint[0],n=Math.abs(e-t),r=this.state.style.lineWidth;return this.state.width=n,this.state.height=r,{width:this.state.width,height:this.state.height}}},{key:"calc4VertexPoints",value:function(){var t=this.state.endPoint[0]-this.state.startPoint[0],e=this.state.endPoint[1]-this.state.startPoint[1],n=this.getRotateAngle(),r=this.state.height,i=Math.cos(n*Math.PI/180)*r/2,o=Math.sin(n*Math.PI/180)*r/2;return i=fn(i,3),o=fn(o,3),[new DOMPoint(0+i,0+o),new DOMPoint(0-i,0-o),new DOMPoint(t+i,e+o),new DOMPoint(t-i,e-o)]}},{key:"getMinBoundingBox",value:function(){var t=this.state.localOrigin.x,e=this.state.localOrigin.y,n=this.calc4VertexPoints(),r=new dn([n[0].x-t,n[0].y-e,n[1].x-t,n[1].y-e,n[2].x-t,n[2].y-e,n[3].x-t,n[3].y-e,0,0]);return r=r.transform(this.state.composedMatrix)}},{key:"setState",value:function(t){m(t.width)||delete t.width,m(t.height)||delete t.height,m(t.transform)||delete t.transform;var e=this.state.startPoint[0],n=this.state.startPoint[1],i=this.state.endPoint[0]-e,o=this.state.endPoint[1]-n;m(t.left)||(this.state.startPoint[0]=t.left,this.state.endPoint[0]=t.left+i),m(t.top)||(this.state.startPoint[1]=t.top,this.state.endPoint[1]=t.top+o),m(t.startPoint)||(this.state.startPoint=p(t.startPoint),this.state.left=this.state.startPoint[0],this.state.top=this.state.startPoint[1]),v(s(r.prototype),"setState",this).call(this,t)}},{key:"getRotateAngle",value:function(){var t=this.state.endPoint[0]-this.state.startPoint[0],e=this.state.endPoint[1]-this.state.startPoint[1],n=vn.calcRotateAngle(t,e,0,0);return n+=90}}]),r}(Tn);var Rn=function(t){return"string"==typeof t||!ee(t)&&Gt(t)&&"[object String]"==V(t)},Ln="0.0.1",qn=function(t){a(o,t);var r=h(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,o),r.call(this,e({width:10,height:10},t))}return i(o,[{key:"calcDots",value:function(){var t=new DOMPoint(0,0),e=new DOMPoint(this.state.width,0),n=new DOMPoint(this.state.width,this.state.height),r=new DOMPoint(0,this.state.height);return this.state.dots=[t,e,n,r],this.state.dots}}]),o}(Tn),Xn=function(t){a(r,t);var e=h(r);function r(t){var i;return n(this,r),o(c(i=e.call(this,t)),"_targetComponent",void 0),i}return i(r,[{key:"renderChildren",value:function(){this.setControlPositions(),v(s(r.prototype),"renderChildren",this).call(this)}},{key:"moveGlobalPosition",value:function(t,e,n){v(s(r.prototype),"moveGlobalPosition",this).call(this,t,e,n),this._targetComponent&&this._targetComponent.moveGlobalPosition(t,e,n)}}]),r}(function(t){a(r,t);var e=h(r);function r(t){var i;return n(this,r),o(c(i=e.call(this,t)),"parentNode",null),o(c(i),"childNodes",[]),i}return i(r,[{key:"addChild",value:function(t){t.parentNode=this,this.childNodes.push(t)}},{key:"removeChild",value:function(t){t.parentNode=null,t.ctx=null,t.root=null,this.childNodes.splice(this.childNodes.indexOf(t),1)}},{key:"renderChildren",value:function(){var t=this;this.childNodes.forEach((function(e){e.ctx=t.ctx,e.root=t.root,e.render()}))}},{key:"render",value:function(){v(s(r.prototype),"render",this).call(this),this.renderChildren()}}]),r}(qn)),Un=function(t){a(i,t);var r=h(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,i);var o=e({radius:10},t);return o.radiusX=o.radius,o.radiusY=o.radius,r.call(this,o)}return i}(function(t){a(o,t);var r=h(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,o);var i=e({radiusX:20,radiusY:10,rotation:0,startAngle:0,endAngle:2*Math.PI,counterclockwise:!0},t);return i.width=2*i.radiusX,i.height=2*i.radiusY,r.call(this,i)}return i(o,[{key:"createPathObject",value:function(){return this.path2D=new Path2D,this.path2D.ellipse(this.state.radiusX-this.state.localOrigin.x,this.state.radiusY-this.state.localOrigin.y,this.state.radiusX,this.state.radiusY,this.state.rotation,this.state.startAngle,this.state.endAngle,this.state.counterclockwise),this.path2D.closePath(),this.path2D}},{key:"setState",value:function(t){m(t.radiusX)?m(t.width)||(t.radiusX=t.width/2):t.width=2*t.radiusX,m(t.radiusY)?m(t.height)||(t.radiusY=t.height/2):t.height=2*t.radiusY,v(s(o.prototype),"setState",this).call(this,t)}}]),o}(Nn)),Yn=function(t){a(r,t);var e=h(r);function r(t){var i;return n(this,r),(i=e.call(this,t)).on("after-move",i.resizeEvtHandler,c(i)),i}return i(r,[{key:"resizeEvtHandler",value:function(t){if(this.parentNode){var e=this.props.position;this.parentNode.trigger("before-resize",new Dn(t,{position:e})),this.parentNode.trigger("after-resize",new Dn(t,{position:e}))}}}]),r}(Un),Hn=function(t){a(s,t);var r=h(s);function s(t){var i;return n(this,s),o(c(i=r.call(this,e(e({},t),{},{zIndex:Number.MAX_VALUE}))),"controlSize",16),o(c(i),"startControl",void 0),o(c(i),"endControl",void 0),i.initControls(),i.initEvents(),i}return i(s,[{key:"initControls",value:function(){var t=1,e=this.state.width,n=this.state.height,r=this.controlSize/2;this.startControl=new Yn({zIndex:Number.MAX_VALUE-t++,left:-r,top:-r,width:this.controlSize,height:this.controlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:"start"}),this.addChild(this.startControl),this.endControl=new Yn({zIndex:Number.MAX_VALUE-t++,left:e-r,top:n-r,width:this.controlSize,height:this.controlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:"end"}),this.addChild(this.endControl)}},{key:"initEvents",value:function(){this.on("after-resize",this.resizeEvtHandler,this)}},{key:"setControlPositions",value:function(){}},{key:"resizeEvtHandler",value:function(t){if(this.targetComponent){var e=t.position,n=t.movementX/window.devicePixelRatio,r=t.movementY/window.devicePixelRatio,i=this.targetComponent.state,o=i.startPoint[0],a=i.startPoint[1],s=i.endPoint[0],u=i.endPoint[1],c=i.absoluteLinearMatrix.inverse(),l=new DOMPoint(n,r).matrixTransform(c);switch(n=l.x,r=l.y,e){case"start":o+=n,a+=r;break;case"end":s+=n,u+=r}this.targetComponent.setState({startPoint:[o,a],endPoint:[s,u]})}}},{key:"targetComponent",get:function(){return this._targetComponent},set:function(t){if(this._targetComponent=t,t){this.setState({left:0,top:0,width:100,height:100,transform:{translate:[0,0],scale:[1,1],skew:[0,0],rotate:0}});var e=this.controlSize/2,n=t.state.startPoint,r=t.state.endPoint,i=new DOMPoint(n[0],n[1]),o=new DOMPoint(r[0],r[1]);this.startControl.setState({left:i.x-e,top:i.y-e}),this.endControl.setState({left:o.x-e,top:o.y-e})}}}]),s}(Xn),Wn=function(t){a(o,t);var r=h(o);function o(t){var i;return n(this,o),(i=r.call(this,e({position:"l",direction:"x",quadrant:1},t))).on("after-move",i.resizeEvtHandler,c(i)),i}return i(o,[{key:"resizeEvtHandler",value:function(t){if(this.parentNode){var e=t.quadrant,n=t.movementX/window.devicePixelRatio,r=t.movementY/window.devicePixelRatio,i=this.parentNode.state,o=i.left,a=i.top,s=i.width,u=i.height,c=i.absoluteLinearMatrix.inverse(),l=new DOMPoint(n,r).matrixTransform(c);switch(n=l.x,r=l.y,e){case 1:o-=n,a+=r,s+=2*n,u-=2*r;break;case 2:o+=n,a+=r,s-=2*n,u-=2*r;break;case 3:o+=n,a-=r,s-=2*n,u+=2*r;break;case 4:o-=n,a-=r,s+=2*n,u+=2*r;break;case 5:a+=r,u-=2*r;break;case 6:a-=r,u+=2*r;break;case 7:o+=n,s-=2*n;break;case 8:o-=n,s+=2*n}var h={top:a,left:o,width:Math.abs(s),height:Math.abs(u)};this.parentNode.trigger("before-resize",new Dn(t,{quadrant:e})),this.parentNode.setState(h),this.parentNode.trigger("after-resize",new Dn(t,{quadrant:e}))}}},{key:"moveGlobalPosition",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Dn,r=t>0?1:-1,i=e>0?1:-1,o=this.parentNode.state,a=o.localOrigin,s=o.width,u=o.height,c=o.absoluteLinearMatrix.inverse(),l=new DOMPoint(t,e).matrixTransform(c);t=l.x,e=l.y;var h=this.state,f=h.left,v=h.top,d=h.quadrant,p=this.state.width/2,y=0;if("x"===this.state.direction)0===fn(f+=t)&&(f=.5*r),y=f+p-a.x>0?8:7;else if("y"===this.state.direction)0===fn(v+=e)&&(v=.5*i),y=v+p-a.y>0?6:5;else if("xy"===this.state.direction){var g=-s/2;0===fn(g)&&(g=.5*r);var m=-u/2,b=m/g,w=s/2;0===fn(w)&&(w=.5*r);var x=-u/2,P=x/w;v+=e=2===d||4==d?b*(f+p-a.x+t)-(v+p-a.y):P*(f+p-a.x+t)-(v+p-a.y),y=(f+=t)+p-a.x>0?v+p-a.y>0?4:1:v+p-a.y>0?3:2}var O=d!==y;O&&this.parentNode.toggleControlQuadrant(this,y),this.setPosition(f,v,new Dn(n,{left:f,top:v,tx:t,ty:e,quadrant:y}))}}]),o}(qn),Fn=function(t){a(r,t);var e=h(r);function r(t){var i;return n(this,r),(i=e.call(this,t)).on("after-move",i.rotateEvtHandler,c(i)),i}return i(r,[{key:"rotateEvtHandler",value:function(t){if(this.parentNode){var e=this.parentNode.state.absoluteOrigin,n={transform:{rotate:vn.calcRotateAngle(t.offsetX,t.offsetY,e.x,e.y)+90}};this.parentNode.trigger("before-rotate",new Dn(n)),this.parentNode.setState(n),this.parentNode.trigger("after-rotate",new Dn(n))}}}]),r}(Un),Vn=function(t){a(s,t);var r=h(s);function s(t){var i;return n(this,s),o(c(i=r.call(this,e(e({},t),{},{zIndex:Number.MAX_VALUE}))),"rotateControlInstance",void 0),o(c(i),"rotateControlSize",8),o(c(i),"rotateControlffsetY",60),o(c(i),"resizeControlInstanceCache",[]),o(c(i),"resizeControlSize",16),i.initControls(),i.initEvents(),i}return i(s,[{key:"initControls",value:function(){var t=this,e=this.state.width,n=this.state.height,r=e/2,i=n/2,o=this.resizeControlSize/2,a=[{direction:"xy",quadrant:2,position:new DOMPoint(-o,-o)},{direction:"y",quadrant:5,position:new DOMPoint(r-o,-o)},{direction:"xy",quadrant:1,position:new DOMPoint(e-o,-o)},{direction:"x",quadrant:8,position:new DOMPoint(e-o,i-o)},{direction:"xy",quadrant:4,position:new DOMPoint(e-o,n-o)},{direction:"y",quadrant:6,position:new DOMPoint(r-o,n-o)},{direction:"xy",quadrant:3,position:new DOMPoint(-o,n-o)},{direction:"x",quadrant:7,position:new DOMPoint(-o,i-o)}],s=1;this.resizeControlInstanceCache=[],a.forEach((function(e){var n=new Wn({zIndex:Number.MAX_VALUE-s++,left:e.position.x,top:e.position.y,width:t.resizeControlSize,height:t.resizeControlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},direction:e.direction,quadrant:e.quadrant});t.addChild(n),t.resizeControlInstanceCache.push(n)}));var u=this.state.width/2-this.rotateControlSize,c=-this.rotateControlffsetY;this.rotateControlInstance=new Fn({zIndex:Number.MAX_VALUE-s++,left:u,top:c,radius:this.rotateControlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1}}),this.addChild(this.rotateControlInstance)}},{key:"initEvents",value:function(){this.on("after-resize",this.resizeEvtHandler,this),this.on("after-rotate",this.rotateEvtHandler,this)}},{key:"setControlPositions",value:function(){var t=this.state.width,e=this.state.height,n=t/2,r=e/2,i=this.resizeControlSize/2;this.resizeControlInstanceCache.forEach((function(o){var a=o.state.quadrant,s=new DOMPoint;switch(a){case 1:s=new DOMPoint(t-i,-i);break;case 2:s=new DOMPoint(-i,-i);break;case 3:s=new DOMPoint(-i,e-i);break;case 4:s=new DOMPoint(t-i,e-i);break;case 5:s=new DOMPoint(n-i,-i);break;case 6:s=new DOMPoint(n-i,e-i);break;case 7:s=new DOMPoint(-i,r-i);break;case 8:s=new DOMPoint(t-i,r-i)}o.setState({left:s.x,top:s.y})}));var o=this.state.width/2-this.rotateControlSize,a=-this.rotateControlffsetY;this.rotateControlInstance.setState({left:o,top:a})}},{key:"rotateEvtHandler",value:function(t){if(this.targetComponent){var e=this.state.transform.rotate;this.targetComponent.setGlobalRotate(e)}}},{key:"resizeEvtHandler",value:function(t){if(this.targetComponent){var e=t.quadrant,n=t.movementX/window.devicePixelRatio,r=t.movementY/window.devicePixelRatio,i=this.targetComponent.state,o=i.left,a=i.top,s=i.width,u=i.height,c=i.absoluteLinearMatrix.inverse(),l=new DOMPoint(n,r).matrixTransform(c);switch(n=l.x,r=l.y,e){case 1:o-=n,a+=r,s+=2*n,u-=2*r;break;case 2:o+=n,a+=r,s-=2*n,u-=2*r;break;case 3:o+=n,a-=r,s-=2*n,u+=2*r;break;case 4:o-=n,a-=r,s+=2*n,u+=2*r;break;case 5:a+=r,u-=2*r;break;case 6:a-=r,u+=2*r;break;case 7:o+=n,s-=2*n;break;case 8:o-=n,s+=2*n}this.targetComponent.setState({left:o,top:a,width:Math.abs(s),height:Math.abs(u)})}}},{key:"targetComponent",get:function(){return this._targetComponent},set:function(t){if(this._targetComponent=t,t){var e=t.getRotateAngle(),n=t.getLocalLeftTop(),r=n.left,i=n.top,o=n.width,a=n.height;this.setState({left:r,top:i,width:o,height:a,transform:{rotate:e}})}}},{key:"toggleControlQuadrant",value:function(t,e){this.resizeControlInstanceCache.forEach((function(t){if(t.state.quadrant===e){var n=0;switch(e){case 1:n=3;break;case 2:n=4;break;case 3:n=1;break;case 4:n=2;break;case 5:n=6;break;case 6:n=5;break;case 7:n=8;break;case 8:n=7}t.setState({quadrant:n})}})),t.setState({quadrant:e})}}]),s}(Xn),$n=function(){function t(e){n(this,t),o(this,"ice",void 0),o(this,"transformControlPanel",void 0),o(this,"lineControlPanel",void 0),o(this,"currentDraggingObj",void 0),this.ice=e,this.transformControlPanel=new Vn({left:500,top:100,width:100,height:100,style:{strokeStyle:"#8b0000",fillStyle:"rgba(255, 255, 49, 0.2)",lineWidth:1},transform:{rotate:45}}),this.ice.addToDisplayMap(this.transformControlPanel),this.lineControlPanel=new Hn({left:700,top:50,width:100,height:100,style:{strokeStyle:"rgba(255, 255, 49, 0)",fillStyle:"rgba(255, 255, 49, 0)",lineWidth:1}}),this.ice.addToDisplayMap(this.lineControlPanel)}return i(t,[{key:"mouseDownHandler",value:function(t){var e=t.target;if(console.log(e),!e.state.interactive)return this.ice.rmFromDisplayMap(this.transformControlPanel),void this.ice.rmFromDisplayMap(this.lineControlPanel);e&&(e instanceof Xn||e.parentNode instanceof Xn)||(t.ctrlKey?this.ice.selectionList.push(e):this.ice.selectionList=[e],e instanceof In?this.lineControlPanel.targetComponent=e:this.transformControlPanel.targetComponent=e),this.currentDraggingObj=e instanceof In?this.lineControlPanel:this.transformControlPanel,e.parentNode instanceof Xn&&(this.currentDraggingObj=e),this.ice.evtBus.on("mousemove",this.mouseMoveHandler,this),this.ice.evtBus.on("mouseup",this.mouseUpHandler,this)}},{key:"mouseMoveHandler",value:function(t){var e=t.movementX/window.devicePixelRatio,n=t.movementY/window.devicePixelRatio;return this.currentDraggingObj.moveGlobalPosition(e,n,t),!0}},{key:"mouseUpHandler",value:function(t){this.ice.evtBus.off("mousemove",this.mouseMoveHandler,this),this.ice.evtBus.off("mouseup",this.mouseUpHandler,this)}},{key:"start",value:function(){return this.ice.evtBus.on("mousedown",this.mouseDownHandler,this),this}},{key:"stop",value:function(){}}]),t}();var Gn=function(t){return void 0===t},Jn={linear:function(t,e,n,r){return t+(e-t)/n*(Date.now()-r)},easeInQuad:function(t,e,n,r){var i=Date.now()-r;return t+(e-t)/n*(i/n)*i}},Kn=function(){function t(e){n(this,t),o(this,"animationMap",new Map),o(this,"ice",void 0),this.ice=e}return i(t,[{key:"start",value:function(){var t=this;return this.ice.evtBus.on(jn,(function(e){t.animationMap.forEach((function(e){e.state.interactive=!1,t.tween(e),e.state.interactive=!0}))})),this}},{key:"tween",value:function(t){var n={},r=t.props.animations,i=1;for(var o in r){var a=r[o];if(a.finished){if(++i===Object.keys(r).length){this.remove(t);break}}else{var s=a.from,u=a.to,c=a.duration;Gn(a.startTime)&&(a.startTime=Date.now()),Gn(a.easing)&&(a.easing="linear");var l=Jn[a.easing](s,u,c,a.startTime);l>u&&(l=u,a.finished=!0),n[o]=Math.floor(l)}}return t.setState(e({},n)),t}},{key:"add",value:function(t){this.animationMap.set(t.props.id,t)}},{key:"remove",value:function(t){Rn(t)?this.animationMap.delete(t):this.animationMap.delete(t.props.id)}},{key:"stop",value:function(){}}]),t}(),Qn={evtBuses:[],frameCallback:function(){Qn.evtBuses.forEach((function(t){t.trigger(jn)})),Cn.requestAnimationFrame(Qn.frameCallback)},start:function(){Cn.requestAnimationFrame(Qn.frameCallback)},stop:function(){},pause:function(){},resume:function(){},regitserEvtBus:function(t){Qn.evtBuses.includes(t)||Qn.evtBuses.push(t)},delEvtBus:function(t){Qn.evtBuses.includes(t)&&Qn.evtBuses.splice(Qn.evtBuses.indexOf(t),1)}},Zn=[["click","ICE_CLICK"],["dbclick","ICE_DBCLICK"],["mousedown","ICE_MOUSEDOWN"],["mouseup","ICE_MOUSEUP"],["mousemove","ICE_MOUSEMOVE"],["mouseenter","ICE_MOUSEENTER"],["mouseleave","ICE_MOUSELEAVE"],["mouseout","ICE_MOUSEOUT"],["mouseover","ICE_MOUSEOVER"],["contextmenu","ICE_CONTEXTMENU"],["mousewheel","ICE_MOUSEWHEEL"]],tr=function(){function t(e){n(this,t),o(this,"selectionCandidates",[]),o(this,"ice",void 0),this.ice=e}return i(t,[{key:"start",value:function(){var t=this;return Zn.forEach((function(e){t.ice.evtBus.on(e[1],(function(n){var r=t.findTargetComponent(n.clientX,n.clientY);r&&(n.target=r,r.trigger(e[0],n)),t.ice.evtBus.trigger(e[0],n)}))})),this}},{key:"findTargetComponent",value:function(t,e){for(var n=t-this.ice.canvasBoundingClientRect.left,r=e-this.ice.canvasBoundingClientRect.top,i=Array.from(this.ice.displayMap.values()),o=0;o<i.length;o++){var a=i[o];this.traverse(n,r,a)}this.selectionCandidates.sort((function(t,e){return t.zIndex-e.zIndex}));var s=this.selectionCandidates[0];return this.selectionCandidates=[],s}},{key:"traverse",value:function(t,e,n){var r=this;n.childNodes&&n.childNodes.length&&n.childNodes.forEach((function(n){r.traverse(t,e,n)})),n.getMinBoundingBox().containsPoint(new DOMPoint(t,e))&&n.state.interactive&&this.selectionCandidates.push(n)}}]),t}(),er=function(t){a(r,t);var e=h(r);function r(){return n(this,r),e.call(this)}return r}(En),nr={evtBuses:[],start:function(){Cn&&Cn&&Cn.addEventListener&&nr.evtBuses.forEach((function(t){Zn.forEach((function(e){Cn.addEventListener(e[0],(function(n){t.trigger(e[1],n)}))}))}))},regitserEvtBus:function(t){nr.evtBuses.includes(t)||nr.evtBuses.push(t)},delEvtBus:function(t){nr.evtBuses.includes(t)&&nr.evtBuses.splice(nr.evtBuses.indexOf(t),1)}},rr=function(){function t(e){n(this,t),o(this,"ice",void 0),this.ice=e}return i(t,[{key:"start",value:function(){var t=this;return this.ice.evtBus.on(jn,(function(e){if(t.ice.ctx.clearRect(0,0,t.ice.canvasWidth,t.ice.canvasHeight),t.ice.displayMap&&t.ice.displayMap.size){var n=Array.from(t.ice.displayMap,(function(t){var e=d(t,2);e[0];return e[1]}));n.sort((function(t,e){return t.state.zIndex-e.state.zIndex})),n.forEach((function(t){!t.isRendering&&t.render()}))}})),this}},{key:"stop",value:function(){throw new Error("Method not implemented.")}}]),t}();Qn.start();let ir=(new(function(){function t(){n(this,t),o(this,"version",Ln),o(this,"displayMap",new Map),o(this,"evtBus",void 0),o(this,"root",void 0),o(this,"ctx",void 0),o(this,"canvasEl",void 0),o(this,"canvasWidth",0),o(this,"canvasHeight",0),o(this,"canvasBoundingClientRect",void 0),o(this,"selectionList",[]),o(this,"animationManager",void 0),o(this,"eventBridge",void 0),o(this,"controlManager",void 0),o(this,"renderer",void 0)}return i(t,[{key:"init",value:function(t){if(!t)throw new Error("init() failed...");if(this.ctx===t)throw new Error("同一个 canvas 实例只能 init 一次...");return this.root=Cn,Rn(t)?(this.canvasEl=this.root.document.getElementById(t),this.canvasEl.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.canvasWidth=this.canvasEl.width,this.canvasHeight=this.canvasEl.height,this.canvasBoundingClientRect=this.canvasEl.getBoundingClientRect(),this.ctx=this.canvasEl.getContext("2d")):this.ctx=t,this.evtBus=new er,Qn.regitserEvtBus(this.evtBus),nr.regitserEvtBus(this.evtBus),nr.start(),this.animationManager=new Kn(this).start(),this.eventBridge=new tr(this).start(),this.controlManager=new $n(this).start(),this.renderer=new rr(this).start(),this}},{key:"destory",value:function(){}},{key:"addToDisplayMap",value:function(t){t.ctx=this.ctx,t.root=this.root,this.displayMap.set(t.props.id,t),Object.keys(t.props.animations).length&&this.animationManager.add(t)}},{key:"rmFromDisplayMap",value:function(t){this.displayMap.delete(t.props.id),t.ctx=null,t.root=null}},{key:"clearRenderMap",value:function(){}},{key:"toJSON",value:function(){return"{}"}},{key:"fromJSON",value:function(t){return{}}}]),t}())).init("canvas-1"),or=new In({left:0,top:0,startPoint:[300,300],endPoint:[100,100],style:{strokeStyle:"#7803e6",fillStyle:"#008000",lineWidth:10},transform:{}});ir.addToDisplayMap(or)}));
