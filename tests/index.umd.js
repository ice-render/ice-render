!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function e(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return l(t)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=s(t);if(e){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return c(this,n)}}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}function v(){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=f(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,r,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);a=!0);}catch(t){s=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var m=Array.isArray,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var x="object"==typeof b&&b&&b.Object===Object&&b,O="object"==typeof self&&self&&self.Object===Object&&self,P=x||O||Function("return this")(),M=P.Symbol,k=Object.prototype,D=k.hasOwnProperty,C=k.toString,A=M?M.toStringTag:void 0;var E=function(t){var e=D.call(t,A),n=t[A];try{t[A]=void 0;var i=!0}catch(t){}var r=C.call(t);return i&&(e?t[A]=n:delete t[A]),r},j=Object.prototype.toString;var S=function(t){return j.call(t)},T=M?M.toStringTag:void 0;var B=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":T&&T in Object(t)?E(t):S(t)};var N=function(t){return null!=t&&"object"==typeof t};var R=function(t){return"symbol"==typeof t||N(t)&&"[object Symbol]"==B(t)},z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Y=/^\w*$/;var U=function(t,e){if(m(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!R(t))||(Y.test(t)||!z.test(t)||null!=e&&t in Object(e))};var I=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var _,F=function(t){if(!I(t))return!1;var e=B(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},L=P["__core-js_shared__"],X=(_=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"";var H=function(t){return!!X&&X in t},G=Function.prototype.toString;var q=function(t){if(null!=t){try{return G.call(t)}catch(t){}try{return t+""}catch(t){}}return""},V=/^\[object .+?Constructor\]$/,W=Function.prototype,K=Object.prototype,Z=W.toString,Q=K.hasOwnProperty,J=RegExp("^"+Z.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var $=function(t){return!(!I(t)||H(t))&&(F(t)?J:V).test(q(t))};var tt=function(t,e){return null==t?void 0:t[e]};var et=function(t,e){var n=tt(t,e);return $(n)?n:void 0},nt=et(Object,"create");var it=function(){this.__data__=nt?nt(null):{},this.size=0};var rt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ot=Object.prototype.hasOwnProperty;var at=function(t){var e=this.__data__;if(nt){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ot.call(e,t)?e[t]:void 0},st=Object.prototype.hasOwnProperty;var ut=function(t){var e=this.__data__;return nt?void 0!==e[t]:st.call(e,t)};var lt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nt&&void 0===e?"__lodash_hash_undefined__":e,this};function ct(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}ct.prototype.clear=it,ct.prototype.delete=rt,ct.prototype.get=at,ct.prototype.has=ut,ct.prototype.set=lt;var ht=ct;var ft=function(){this.__data__=[],this.size=0};var vt=function(t,e){return t===e||t!=t&&e!=e};var dt=function(t,e){for(var n=t.length;n--;)if(vt(t[n][0],e))return n;return-1},pt=Array.prototype.splice;var yt=function(t){var e=this.__data__,n=dt(e,t);return!(n<0)&&(n==e.length-1?e.pop():pt.call(e,n,1),--this.size,!0)};var gt=function(t){var e=this.__data__,n=dt(e,t);return n<0?void 0:e[n][1]};var mt=function(t){return dt(this.__data__,t)>-1};var bt=function(t,e){var n=this.__data__,i=dt(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this};function wt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}wt.prototype.clear=ft,wt.prototype.delete=yt,wt.prototype.get=gt,wt.prototype.has=mt,wt.prototype.set=bt;var xt=wt,Ot=et(P,"Map");var Pt=function(){this.size=0,this.__data__={hash:new ht,map:new(Ot||xt),string:new ht}};var Mt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var kt=function(t,e){var n=t.__data__;return Mt(e)?n["string"==typeof e?"string":"hash"]:n.map};var Dt=function(t){var e=kt(this,t).delete(t);return this.size-=e?1:0,e};var Ct=function(t){return kt(this,t).get(t)};var At=function(t){return kt(this,t).has(t)};var Et=function(t,e){var n=kt(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this};function jt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}jt.prototype.clear=Pt,jt.prototype.delete=Dt,jt.prototype.get=Ct,jt.prototype.has=At,jt.prototype.set=Et;var St=jt;function Tt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a)||o,a};return n.cache=new(Tt.Cache||St),n}Tt.Cache=St;var Bt=Tt;var Nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rt=/\\(\\)?/g,zt=function(t){var e=Bt(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Nt,(function(t,n,i,r){e.push(i?r.replace(Rt,"$1"):n||t)})),e}));var Yt=function(t,e){for(var n=-1,i=null==t?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r},Ut=M?M.prototype:void 0,It=Ut?Ut.toString:void 0;var _t=function t(e){if("string"==typeof e)return e;if(m(e))return Yt(e,t)+"";if(R(e))return It?It.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n};var Ft=function(t){return null==t?"":_t(t)};var Lt=function(t,e){return m(t)?t:U(t,e)?[t]:zt(Ft(t))};var Xt=function(t){if("string"==typeof t||R(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Ht=function(t,e){for(var n=0,i=(e=Lt(e,t)).length;null!=t&&n<i;)t=t[Xt(e[n++])];return n&&n==i?t:void 0};var Gt=function(t,e,n){var i=null==t?void 0:Ht(t,e);return void 0===i?n:i};var qt=function(){this.__data__=new xt,this.size=0};var Vt=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var Wt=function(t){return this.__data__.get(t)};var Kt=function(t){return this.__data__.has(t)};var Zt=function(t,e){var n=this.__data__;if(n instanceof xt){var i=n.__data__;if(!Ot||i.length<199)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new St(i)}return n.set(t,e),this.size=n.size,this};function Qt(t){var e=this.__data__=new xt(t);this.size=e.size}Qt.prototype.clear=qt,Qt.prototype.delete=Vt,Qt.prototype.get=Wt,Qt.prototype.has=Kt,Qt.prototype.set=Zt;var Jt=Qt,$t=function(){try{var t=et(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var te=function(t,e,n){"__proto__"==e&&$t?$t(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var ee=function(t,e,n){(void 0!==n&&!vt(t[e],n)||void 0===n&&!(e in t))&&te(t,e,n)};var ne=function(t){return function(e,n,i){for(var r=-1,o=Object(e),a=i(e),s=a.length;s--;){var u=a[t?s:++r];if(!1===n(o[u],u,o))break}return e}}(),ie=w((function(t,e){var n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,r=i&&i.exports===n?P.Buffer:void 0,o=r?r.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,i=o?o(n):new t.constructor(n);return t.copy(i),i}})),re=P.Uint8Array;var oe=function(t){var e=new t.constructor(t.byteLength);return new re(e).set(new re(t)),e};var ae=function(t,e){var n=e?oe(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var se=function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e},ue=Object.create,le=function(){function t(){}return function(e){if(!I(e))return{};if(ue)return ue(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var ce=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object),he=Object.prototype;var fe=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||he)};var ve=function(t){return"function"!=typeof t.constructor||fe(t)?{}:le(ce(t))};var de=function(t){return N(t)&&"[object Arguments]"==B(t)},pe=Object.prototype,ye=pe.hasOwnProperty,ge=pe.propertyIsEnumerable,me=de(function(){return arguments}())?de:function(t){return N(t)&&ye.call(t,"callee")&&!ge.call(t,"callee")};var be=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var we=function(t){return null!=t&&be(t.length)&&!F(t)};var xe=function(t){return N(t)&&we(t)};var Oe=function(){return!1},Pe=w((function(t,e){var n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,r=i&&i.exports===n?P.Buffer:void 0,o=(r?r.isBuffer:void 0)||Oe;t.exports=o})),Me=Function.prototype,ke=Object.prototype,De=Me.toString,Ce=ke.hasOwnProperty,Ae=De.call(Object);var Ee=function(t){if(!N(t)||"[object Object]"!=B(t))return!1;var e=ce(t);if(null===e)return!0;var n=Ce.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&De.call(n)==Ae},je={};je["[object Float32Array]"]=je["[object Float64Array]"]=je["[object Int8Array]"]=je["[object Int16Array]"]=je["[object Int32Array]"]=je["[object Uint8Array]"]=je["[object Uint8ClampedArray]"]=je["[object Uint16Array]"]=je["[object Uint32Array]"]=!0,je["[object Arguments]"]=je["[object Array]"]=je["[object ArrayBuffer]"]=je["[object Boolean]"]=je["[object DataView]"]=je["[object Date]"]=je["[object Error]"]=je["[object Function]"]=je["[object Map]"]=je["[object Number]"]=je["[object Object]"]=je["[object RegExp]"]=je["[object Set]"]=je["[object String]"]=je["[object WeakMap]"]=!1;var Se=function(t){return N(t)&&be(t.length)&&!!je[B(t)]};var Te=function(t){return function(e){return t(e)}},Be=w((function(t,e){var n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,r=i&&i.exports===n&&x.process,o=function(){try{var t=i&&i.require&&i.require("util").types;return t||r&&r.binding&&r.binding("util")}catch(t){}}();t.exports=o})),Ne=Be&&Be.isTypedArray,Re=Ne?Te(Ne):Se;var ze=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},Ye=Object.prototype.hasOwnProperty;var Ue=function(t,e,n){var i=t[e];Ye.call(t,e)&&vt(i,n)&&(void 0!==n||e in t)||te(t,e,n)};var Ie=function(t,e,n,i){var r=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=i?i(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),r?te(n,s,u):Ue(n,s,u)}return n};var _e=function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i},Fe=/^(?:0|[1-9]\d*)$/;var Le=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Fe.test(t))&&t>-1&&t%1==0&&t<e},Xe=Object.prototype.hasOwnProperty;var He=function(t,e){var n=m(t),i=!n&&me(t),r=!n&&!i&&Pe(t),o=!n&&!i&&!r&&Re(t),a=n||i||r||o,s=a?_e(t.length,String):[],u=s.length;for(var l in t)!e&&!Xe.call(t,l)||a&&("length"==l||r&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Le(l,u))||s.push(l);return s};var Ge=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},qe=Object.prototype.hasOwnProperty;var Ve=function(t){if(!I(t))return Ge(t);var e=fe(t),n=[];for(var i in t)("constructor"!=i||!e&&qe.call(t,i))&&n.push(i);return n};var We=function(t){return we(t)?He(t,!0):Ve(t)};var Ke=function(t){return Ie(t,We(t))};var Ze=function(t,e,n,i,r,o,a){var s=ze(t,n),u=ze(e,n),l=a.get(u);if(l)ee(t,n,l);else{var c=o?o(s,u,n+"",t,e,a):void 0,h=void 0===c;if(h){var f=m(u),v=!f&&Pe(u),d=!f&&!v&&Re(u);c=u,f||v||d?m(s)?c=s:xe(s)?c=se(s):v?(h=!1,c=ie(u,!0)):d?(h=!1,c=ae(u,!0)):c=[]:Ee(u)||me(u)?(c=s,me(s)?c=Ke(s):I(s)&&!F(s)||(c=ve(u))):h=!1}h&&(a.set(u,c),r(c,u,i,o,a),a.delete(u)),ee(t,n,c)}};var Qe=function t(e,n,i,r,o){e!==n&&ne(n,(function(a,s){if(o||(o=new Jt),I(a))Ze(e,n,s,i,t,r,o);else{var u=r?r(ze(e,s),a,s+"",e,n,o):void 0;void 0===u&&(u=a),ee(e,s,u)}}),We)};var Je=function(t){return t};var $e=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},tn=Math.max;var en=function(t,e,n){return e=tn(void 0===e?t.length-1:e,0),function(){for(var i=arguments,r=-1,o=tn(i.length-e,0),a=Array(o);++r<o;)a[r]=i[e+r];r=-1;for(var s=Array(e+1);++r<e;)s[r]=i[r];return s[e]=n(a),$e(t,this,s)}};var nn=function(t){return function(){return t}},rn=$t?function(t,e){return $t(t,"toString",{configurable:!0,enumerable:!1,value:nn(e),writable:!0})}:Je,on=Date.now;var an=function(t){var e=0,n=0;return function(){var i=on(),r=16-(i-n);if(n=i,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(rn);var sn=function(t,e){return an(en(t,e,Je),t+"")};var un=function(t,e,n){if(!I(n))return!1;var i=typeof e;return!!("number"==i?we(n)&&Le(e,n.length):"string"==i&&e in n)&&vt(n[e],t)};var ln=function(t){return sn((function(e,n){var i=-1,r=n.length,o=r>1?n[r-1]:void 0,a=r>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(r--,o):void 0,a&&un(n[0],n[1],a)&&(o=r<3?void 0:o,r=1),e=Object(e);++i<r;){var s=n[i];s&&t(e,s,i,o)}return e}))}((function(t,e,n){Qe(t,e,n)})),cn=window||global,hn=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in n(this,t),o(this,"originalEvent",void 0),o(this,"target",void 0),e)this[r]=e[r];for(var a in i)this[a]=i[a]},fn=function(){function t(){n(this,t),o(this,"listeners",{}),o(this,"suspendedEventNames",[])}return r(t,[{key:"on",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cn;this.listeners[t]||(this.listeners[t]=[]),this.off(t,e,n),this.listeners[t].push({callback:e,scope:n})}},{key:"off",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cn,i=this.listeners[t];if(i)for(var r=0;r<i.length;r++){var o=i[r];if(o.callback===e&&o.scope===n)return void this.listeners[t].splice(r,1)}}},{key:"once",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cn;this.on(t,(function(i,r){n.off(t,e,r),e.call(r,i)}),i)}},{key:"trigger",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!!this.listeners[t]&&(!this.suspendedEventNames.includes(t)&&(n?(e=new hn(n)).originalEvent=n:e=new hn({type:t,timeStamp:(new Date).getTime()}),this.listeners[t].forEach((function(t){var n=t.callback,i=t.scope;n.call(i,e)})),!0))}},{key:"suspend",value:function(t,e){t&&!this.suspendedEventNames.includes(t)&&this.suspendedEventNames.push(t),e&&(e.prototype.suspended=!0)}},{key:"resume",value:function(t,e){t&&this.suspendedEventNames.includes(t)&&this.suspendedEventNames.splice(this.suspendedEventNames.findIndex(t),1),e&&(e.prototype.suspended=!1)}},{key:"purge",value:function(){this.listeners={}}}]),t}();fn.prototype.addEventListener=fn.prototype.on,fn.prototype.removeEventListener=fn.prototype.off,fn.prototype.dispatchEvent=fn.prototype.trigger;var vn=function(){function t(){throw n(this,t),new Error("GeometryUtil is a static util class.")}return r(t,null,[{key:"containsPoint",value:function(t,e){return!1}},{key:"isIntersect",value:function(t,e){return!1}},{key:"getLength",value:function(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}},{key:"calcRotateAngle",value:function(t,e,n,i){var r=t-n,o=e-i,a=r/Math.sqrt(r*r+o*o);return(o/Math.sqrt(r*r+o*o)<0?-1:1)*Math.acos(a)*180/Math.PI}}]),t}(),dn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0,0];n(this,t),o(this,"tl",new DOMPoint),o(this,"tr",new DOMPoint),o(this,"bl",new DOMPoint),o(this,"br",new DOMPoint),o(this,"center",new DOMPoint),this.tl=new DOMPoint(e[0],e[1]),this.tr=new DOMPoint(e[2],e[3]),this.bl=new DOMPoint(e[4],e[5]),this.br=new DOMPoint(e[6],e[7]),this.center=new DOMPoint(e[8],e[9])}return r(t,[{key:"clone",value:function(){var e=DOMPoint.fromPoint(this.tl),n=DOMPoint.fromPoint(this.tr),i=DOMPoint.fromPoint(this.bl),r=DOMPoint.fromPoint(this.br),o=DOMPoint.fromPoint(this.center);return new t([e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y,o.x,o.y])}},{key:"containsPoint",value:function(t){var e=this.getMinAndMaxPoint(),n=e.minX,i=e.minY,r=e.maxX,o=e.maxY;if(t.x<n||t.x>r||t.y<i||t.y>o)return!1;for(var a,s=0,u=this.getBoundingLines(),l=0;l<u.length;l++){var c=u[l];if(!(t.y>c.o.y&&t.y>c.d.y)&&!(t.y<c.o.y&&t.y<c.d.y)){if(c.o.x===c.d.x&&c.o.x>=t.x)a=c.o.x;else{var h=(c.d.y-c.o.y)/(c.d.x-c.o.x);a=c.o.x+(t.y-c.o.y)/h}a>t.x&&s++}}return 0!==s&&s%2==1}},{key:"getBoundingLines",value:function(){return[{o:DOMPoint.fromPoint(this.tl),d:DOMPoint.fromPoint(this.tr)},{o:DOMPoint.fromPoint(this.tr),d:DOMPoint.fromPoint(this.br)},{o:DOMPoint.fromPoint(this.br),d:DOMPoint.fromPoint(this.bl)},{o:DOMPoint.fromPoint(this.bl),d:DOMPoint.fromPoint(this.tl)}]}},{key:"getMinAndMaxPoint",value:function(){var t=this.tl.x,e=this.tl.y,n=this.tl.x,i=this.tl.y;return[this.tr,this.bl,this.br].forEach((function(r){r.x<t&&(t=r.x),r.x>n&&(n=r.x),r.y<e&&(e=r.y),r.y>i&&(i=r.y)})),{minX:t,minY:e,maxX:n,maxY:i}}},{key:"containsBox",value:function(t){return!1}},{key:"isIntersect",value:function(t){return!1}},{key:"transform",value:function(e){var n=DOMPoint.fromPoint(this.tl).matrixTransform(e),i=DOMPoint.fromPoint(this.tr).matrixTransform(e),r=DOMPoint.fromPoint(this.bl).matrixTransform(e),o=DOMPoint.fromPoint(this.br).matrixTransform(e),a=DOMPoint.fromPoint(this.center).matrixTransform(e);return new t([n.x,n.y,i.x,i.y,r.x,r.y,o.x,o.y,a.x,a.y])}},{key:"union",value:function(t){return null}},{key:"width",get:function(){return vn.getLength(this.br.x,this.br.y,this.bl.x,this.bl.y)}},{key:"height",get:function(){return vn.getLength(this.br.x,this.br.y,this.tr.x,this.tr.y)}},{key:"left",get:function(){return this.tl.x},set:function(t){throw new Error("Can not set left to ICEBoundingBox directly.")}},{key:"top",get:function(){return this.tl.y},set:function(t){throw new Error("Can not set top to ICEBoundingBox directly.")}},{key:"centerX",get:function(){return this.center.x}},{key:"centerY",get:function(){return this.center.y}},{key:"centerPoint",get:function(){return this.center}}],[{key:"fromDimension",value:function(e,n,i,r){return new t([].concat([e,n],[e+i,n],[e,n+r],[e+i,n+r],[e+i/2,n+r/2]))}}]),t}(),pn=function(){function t(){n(this,t)}return r(t,null,[{key:"calcRotateAngle",value:function(t){var e=0,n=t.a,i=t.b,r=i/Math.sqrt(n*n+i*i),o=n/Math.sqrt(n*n+i*i);return e=Math.acos(o),r<0&&(e+=Math.PI/2),e*(180/Math.PI)}},{key:"calcScale",value:function(t){return[Math.sqrt(t.a*t.a+t.b*t.b)/t.a,Math.sqrt(t.c*t.c+t.d*t.d)/t.d]}}]),t}(),yn="ICE_FRAME_EVENT",gn="BEFORE_RENDER",mn="AFTER_RENDER",bn=function(t){a(s,t);var i=h(s);function s(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,s),o(l(t=i.call(this)),"root",null),o(l(t),"ctx",null),o(l(t),"parentNode",null),o(l(t),"isRendering",!1),o(l(t),"props",{id:"ICE_"+Math.floor(1e10*Math.random()),left:0,top:0,width:0,height:0,style:{fillStyle:"red",strokeStyle:"blue",lineWidth:1},animations:{},transform:{translate:[0,0],scale:[1,1],skew:[0,0],rotate:0},translationMatrix:new DOMMatrix,linearMatrix:new DOMMatrix,composedMatrix:new DOMMatrix,origin:"localCenter",localOrigin:new DOMPoint(0,0),absoluteOrigin:new DOMPoint(0,0),zIndex:s.instanceCounter++,draggable:!0,selectable:!0,interactive:!0}),o(l(t),"state",e({},t.props)),t.props=ln(t.props,r),t.state=JSON.parse(JSON.stringify(t.props)),t}return r(s,[{key:"render",value:function(){this.isRendering=!0,this.trigger(gn),this.applyStyle(),this.calcOriginalDimension(),this.applyTransformToCtx(),this.doRender(),this.ctx.setTransform(new DOMMatrix),this.trigger(mn),this.isRendering=!1}},{key:"applyStyle",value:function(){Object.assign(this.ctx,e(e({},this.props.style),this.state.style))}},{key:"calcOriginalDimension",value:function(){return{width:this.state.width,height:this.state.height}}},{key:"calcLocalOrigin",value:function(){var t=new DOMPoint(0,0),e=this.state.origin;if(!e||"localCenter"===e){var n=this.state.width/2,i=this.state.height/2;t.x=n,t.y=i}return this.state.localOrigin=t,t}},{key:"calcAbsoluteOrigin",value:function(){var t=Gt(this,"state.transform.translate.0")+this.state.left,e=Gt(this,"state.transform.translate.1")+this.state.top,n=DOMPoint.fromPoint(this.calcLocalOrigin());if(n.x+=t,n.y+=e,this.parentNode){var i=this.parentNode.state.localOrigin.x,r=this.parentNode.state.localOrigin.y;n=n.matrixTransform(new DOMMatrix([1,0,0,1,-i,-r]));var o=this.parentNode.state.composedMatrix;n=n.matrixTransform(o)}return this.state.absoluteOrigin=n,n}},{key:"calcLinearMatrix",value:function(){var t=new DOMMatrix,e=Gt(this,"state.transform.skew.0"),n=Gt(this,"state.transform.skew.1");t.skewXSelf(e),t.skewYSelf(n);var i=Gt(this,"state.transform.rotate");t.rotateSelf(i);var r=Gt(this,"state.transform.scale.0"),o=Gt(this,"state.transform.scale.1");return t.scaleSelf(r,o),this.state.linearMatrix=t,t}},{key:"calcAbsoluteLinearMatrix",value:function(){for(var t=this,e=DOMMatrix.fromMatrix(t.calcLinearMatrix());t.parentNode;)e.multiplySelf(t.parentNode.state.linearMatrix),t=t.parentNode;return this.state.absoluteLinearMatrix=DOMMatrix.fromMatrix(e),e}},{key:"composeMatrix",value:function(){var t=this.calcAbsoluteOrigin(),e=new DOMMatrix([1,0,0,1,t.x,t.y]),n=this.calcAbsoluteLinearMatrix(),i=e.multiplySelf(n);return this.state.composedMatrix=DOMMatrix.fromMatrix(i),i}},{key:"applyTransformToCtx",value:function(){this.ctx.setTransform(this.composeMatrix())}},{key:"doRender",value:function(){var t=this.getMinBoundingBox();this.ctx.setTransform(new DOMMatrix),this.ctx.lineWidth=1,this.ctx.strokeStyle="#ff0000",this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.beginPath(),this.ctx.moveTo(t.tl.x,t.tl.y),this.ctx.lineTo(t.tr.x,t.tr.y),this.ctx.lineTo(t.br.x,t.br.y),this.ctx.lineTo(t.bl.x,t.bl.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill();var e=this.getMaxBoundingBox();this.ctx.setTransform(new DOMMatrix),this.ctx.lineWidth=1,this.ctx.strokeStyle="#0000ff",this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.beginPath(),this.ctx.moveTo(e.tl.x,e.tl.y),this.ctx.lineTo(e.tr.x,e.tr.y),this.ctx.lineTo(e.br.x,e.br.y),this.ctx.lineTo(e.bl.x,e.bl.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill()}},{key:"getMinBoundingBox",value:function(){var t=this.state.localOrigin.x,e=this.state.localOrigin.y,n=this.state.width,i=this.state.height,r=new dn([0-t,0-e,0-t+n,0-e,0-t,0-e+i,0-t+n,0-e+i,0,0]);return r=r.transform(this.state.composedMatrix)}},{key:"getMaxBoundingBox",value:function(){var t=this.getMinBoundingBox(),e=t.getMinAndMaxPoint(),n=e.minX,i=e.minY,r=e.maxX,o=e.maxY,a=t.centerPoint;return t=new dn([n,i,r,i,n,o,r,o,a.x,a.y])}},{key:"setState",value:function(t){ln(this.state,t)}},{key:"setPosition",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new hn;this.trigger("before-move",e(e({},i),{},{left:t,top:n})),this.setState({left:t,top:n}),this.trigger("after-move",e(e({},i),{},{left:t,top:n}))}},{key:"moveGlobalPosition",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new hn;if(this.parentNode){var r=new DOMPoint(t,n),o=this.parentNode.state.absoluteLinearMatrix.inverse();t=(r=r.matrixTransform(o)).x,n=r.y}this.setPosition(this.state.left+t,this.state.top+n,e(e({},i),{},{tx:t,ty:n}))}},{key:"setGlobalRotate",value:function(t){if(this.parentNode){var e=this.parentNode.state.absoluteLinearMatrix;t-=pn.calcRotateAngle(e)}this.setState({transform:{rotate:t}})}},{key:"localCoordToGlobal",value:function(t,e){var n=new DOMPoint(t,e),i=this.state.composedMatrix;return n=n.matrixTransform(i)}},{key:"globalCoordToLocal",value:function(t,e){var n=new DOMPoint(t,e),i=this.state.composedMatrix.inverse();return n=n.matrixTransform(i)}},{key:"getRotateAngle",value:function(){var t=this.state.composedMatrix;return pn.calcRotateAngle(t)}},{key:"getLocalLeftTop",value:function(){var t=this.getMinBoundingBox(),e=t.width,n=t.height;return{left:t.centerX-t.width/2,top:t.centerY-t.height/2,width:e,height:n}}},{key:"toJSON",value:function(){return"{}"}},{key:"fromJSON",value:function(t){return{}}}]),s}(fn);o(bn,"instanceCounter",0);var wn=function(t){a(o,t);var i=h(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,o),i.call(this,e({width:100,height:100},t))}return r(o,[{key:"doRender",value:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO0AAADUCAMAAABH5lTYAAAAYFBMVEX///8A2P8A1/8A1f/x/P/s+/++8f/7/v/e+P+i7P/4/v9j4f/O9P/k+f+H5//G8//W9v+Z6v9V3/+s7f+07/9z5P+T6f+A5v9F3f/L9P+F5v+x7v+o7f8w2/945P9J3v9/jwyPAAATg0lEQVR4nO0dabeyOO9aFBdUFBFX9P//yxdcSNKmS4ow75wz+TLzeKE0bZo96d/ff/Af2GC1K5fVttof8s0Ao8/y5SkrzufiWKWzAcYXwaKqE9VBUl/T1e8Gnx0yhUZvhq/+SYTzBtUJgWZK5+VPpjTbt+s40YZPsn8K3805mTDQIlz2HTt96uvY4Vv9Yu5iuFnm80JYbXvswWqvjF1Fg5/nv0MiFE7sxmKaW8QNvNral/E99GT6W1T88HDP6IVvEcGk5z5cX+j+kBWGwN69s93+Sndh6SBhNHA9CFI2WIcgOxHzlMskBNd23GwozBiY00l95SE7L5WGjjrNuDV8S9pEGz4JHrU/HBWezeSxTNP0UGUTU0C2EyvCyPnAvNzg+dyWu81stkiv5O9qYBQBFmgP1HkHf5imR2aLVXL3jzk9m+8pdbrgZw54kbe/xsoGT/hqstf/mGcmU1Vn3/aWxksNi8v1p2boXCcjiaEdbG1yYP6+2hvMRiVu7co4sY16wmGzgoHH2tys+6R6WB4pDXwTBxfd6U8rZZDM91FYlnFO7grtg/0pA181selWS21jnWJrC0t964VGINzhe04xcNf5FUv2mFS+VOA8kfD1cw8kggGYp0ejmT+0TUuO5kOzWpPd9c58CMO+ez4ZwfgDQlZeu25hoKIruGtKAMrk8TrM4fsBgq0vpLC2AU8vqWRRih7eA919VQdsV6faqCIOAwl0xk+YrqpTKlH5rhRZ/8a2kMPJjUJABHX3rUBVdW9FifInO9PWAEjZc8T7AxzbYGVmQYVR8hXSVFd0CWQKRUddgx/cXShHxqBt4uu8rSiJW8QTB8sOW5ty8zPoNHPFiBMrUAWilZRTsuE693LCOmbB42AbR0Y7aq7VlLpljjV0mISTF0NHlOrifxjBtNZYEv6HhEwaAPIfWr/oWHIidbHpGiLMOUjwIAA2NTRTFukWFLa8M0vudDl12A7trwFhJ3/3wPqd5PuzH0sETbsJx/DD3EBXqQifc9lhO3CUZPOdr3rGvL7Tzm6c27/THdUpZhLhsJBpyQZsKLaGTRQE6yiZHwG7ntgCT+8xSN8lD4Zdz2XVDd6o6W7Gsvl6EtFTl7lRJ+9fgi2jYCRL+TDAKgfGthclbzltKiKiM9re9uFSrHLRoCtWL0bDdhH/IRIFJRaQVOaOxpNn3ZGRenM3BNkSB84cTngWeovBUIjWHOeEeBd/KUZXqJddRnNexFoF2AmVrJsf7hhdmRzqnLyDR74iLT4c3/7E+zCHTkQxHfAWSS1jKYA1L+EtZCO/U8TSN5GkG4HFF+66i4NOG5L4zXYYWRDUWI1UAvtgPGse4hJG5NwKU4wV4kiYc0l4PPjGhvbUVBF+A7SHVNps4jhVvG9MCgc5PyQZONRLiJ0Z4SpkD9+YEC5iyY4ViZfswbDHnCrQX7rq4xuTASI+8QsTJpUIMebQfD5QpYaPzksd9ZgTcXYTPtRhdhUoFwM7av5wRDNIBHn3DjPssKNbjaZcYPYfMrUb5rq8PnLBpB5ydGUz6AewsgHO3I2LQxkjBh5deDoy31sAcGoCLFzkYVR2lwzyVoXItfFCfHi7/Pz/hM7kebPO07I83JfL5b6B5j/3w61M88sO+9T9noyoeHk0gGx3azLTzY3GqO2AH5ssPGc3Ll4eC08Pk9hcbtXxOUnYZOUAaFOv6+y6THc8V4Okngh3pRiATV01NPP7qZgk9jx0CcqvjHNVH6t0ocXtQQTa2N4vITXPzfSyPNavbPi+WHJYJ5OsSrtTg/IQxqgcmRKeOMurQulZ/7+GF87nU9lKnMuoTArLu1M2OKIUZVXswcAePH/oBWDBjYUoQbn7397FgkGQjo4jC2qMas30ETc3J0SNmN2GLaRY3QqxFG1Ll5JJfS6y42lb7V8a1K0sb7dDq1btq+3jmBXnun1KPvJ5OZSvZnV7hqFK097Os8AdmM9opCjkW2299W+KmymkmR/Vdw1ane3Rb6J0NeS3UdnpqYIkeLPDt59W5G6unq++lYBie1u3G5mjScu0O+xhbv45X6T7j9ri/npy/JlelZ5dJ+ql4T2vtx2sL0JW6DlC9jASp5u08gn2hqJ/kSk2d1Z1t/hsS41TII+qOO0SWfaa7TfN94V7Jura8wRPr76qbpMF4XIsueMI2f+MZnhwU3R09XoL04dXKDBxJ/d8fYDqP5kzf/TMRyVFZLBkdeJxbcXcs/uHEWheIlqMEYbI32GGEeFvTDOML74xX92zuDaoZuUUcV3d7JqivYmLJaOP6eEI8lm21veF71GqY6VcBXuL6sdfAc4pLc6cURkSASg2pLspwf558/rLg0VYWK0/ezLJPg2NgNUBPl1KykgdSsJDnhQK64KB/dMdaa64uQ0lhn+cIeJmCfeYPlB9GyEbYFHx+S5TG6NCH0WyZn4wuuW0T2Rhng29Fu21rZleM8HXDt5dLCYYEKMjIXs4JRqzXzDCI6wZg9l+hm06w34ZdYbo5RBEFIK8qKg60xh8vjQZTUD1GFPBzqoIiKqA4596s6g34NMP+sLNcno+UBo0qSYej7f+hrLuEXCMjgFu7NxUCKg0HzTts4UzdpAa+DqDhguNn9ur9Yla8/0JmKmDRc1uj3PrWq+Lys43MaP6ThiFZKweKUNwOmTRhVKxSh4Ovgaezq8XG9OfjUXd686WaY0ng/l9YW+eCTAYEoc5q7f1sa67Vr+iajfVGwMi3mJZ0UrXBRpDzYIveuZzlkIIp4H5UUODD0XmWozKl2e21da6RAyZfYHvMJQULAEhx6Z6DY9Kqj0VhDutZJBDd0eRfXrF5UYTuehl9lxZCtuadWXNFkgDfcebCpNPWIF+iqGFGVmPoELCmohcpBKwhl7Bbezna9zqLCgXmMHaBijBtDuKmXgWsNo6IPm3w8YYK32MahEvukdyUBGPCvJQkMXVC7ex6WJ2pbAALPcRzYY9J9ZyVPsCISnUKDAwfGDqdoWpmVraJBM8uGLggdbbbcMv3cjy+TZ4ARGPCk2kKcnhxX/BOxtuu+w4vsPlB2wsDAq9xe0YYsvoyeDpYWc8PuxIvxUZaqQo7wOcYmH2BTPRZY7unXlNUoSK0YXTjvU0kQP4Zk6Hc89cvFvbAjN+4GJaAakQsIvXaNOFwZbR6gK2lt9cM3Yq9BFgl+B3c9FPQn+sUavGEZr/1L7e5KjKOCpS2woZKp+cGFD5xF7CmWENMw9VIVvLy1HjDEg91Ni/8P4FGZPCsQwNibUQOV7GAKuYa4dAnn0A0YWPqcZ48oJBa1HKLdcqiJB50RUyvgfg3dchg2MVk4BEK8O55dI7A1iBpVKiccb0QIDioZfWBB0GYtoclGQ23idcwKakEg0mZju0LFToHhEVycBqDms5ebXGDhdWlOJ03qgMKVBv2391GktcZ5ClwfU02Adjyxo3CzR+VHwWqodaygBso1zApU816YntGmEbFa2E8ed4unGdQXB6OVtpyWm7PLbsqUQyKK5wnKaq92vFlRNcuCeCU+fYg7C2m6lhgERC+0+UkxoxGJUQrMslFFvWICHqRUy2eWcEfFRsGExOygtNdeCeCdUuuK9r2kVEKE3XncC6lQ+mJUKwJ9fhfyPvck4JvdOLWEgif9bb4oGDK465mloh85A7EaYDLgJgNKSSqo7YbPn8hL4orJ4ypAsns8MUZXalDYNCqhMAbXSqD1YQZLTMTJp5ypf3815oRphy7Fw0P5yg08k3hK1ICuXmbDjt0bCCGWCVdO45STYH6hWDTjxSAESmAcd/OFfNyb+5nPRj3F4iDYP4jdG06qjh0J6h5eLYphdZ9i006Nm5LAHIYlcBadEQvLsoyueJ3bKeZ4wsd4CABaoChYFChRBueaQ5vbA7TdWByc04GALEyio8Nze6XLcLdDdBIypBZwsUQiTOpzNfrKH5sjM+AByzYR1IzLCOS9cVO4o15U5EDUChkSDfFI166axtRTiC5+oIY8A/ErVhFd67FV014ZDFKSvt3+HxAAe/1sLXlBPU68s129cArIm3uwgRHisldpZc6oRni8gT/HJZoM79XsqjhMS6PLTg/MRnOoNO8jbDsR3LvjA/Mhl6ykKYmO29DvUqmE9ttEwEXh3W7Q2PRQSVoZ/NQR+weEEWhd7Q3+pFRCkrHzoMdXtXSQiypvPWGSoFUvg+hhNDbM7BGb6bESfFaoD1ne/sgkK4esaUw3NnZIed7XGhq7nUZ7cU+sA0X26Px0d1cxwVHNDoVgR+sipAOz3A5sxUnuorY8/jBsw6it95pFA4oPvvQO9AfIonnY2Rq+yz6XTVVyUnFl9IhUPGS8ZNMgJwPg0E9ZAQ4Oy+hYFrgN5gqAEqeTDy8EGErTGffk3M0JHAPAb6nZtruS4Mhh9034NxE1ObjG2cMdNKbgEX4sXX1iEXNVG64Xfd9Vya6ee+y7U6MO/FU0lN30XVG4Ra0Cvx3SjQklX8H8gSb7bc3Xb+ZD7AhVMDrojzgDuCEhUu+Iht2oav6KR/4b5aclWGNp3FAlzlU1sZ+F0wa8zXXvARCphFaSz1olNUfuSKoBpOIzxGCzY1RCXPQ4vw2nqCsIUf13EeaVGG/k8WOeergSaJQ0uwAlsA9bmqeWsh5D9aZRkTk3NWxgGR15ZKr4ZfR9YhGbeufRFWVkL+I4wqom+buzIOB/y4qTW/9ugL4b2Oltk+lAcTERH2nHvndFQvXFu4u6+kVaV5RpBGJQ61pHYW9bcpr670nOaI/aBzGiO5yXom5xMuI6eXXQpTObA1gFX/Rbl99Qxw4WpqQHGwYysDEcLvPkHltyEUrjCQKZC4Q+Dbht+lVVb7eiPoVYY9Ybr09qT5NITKqttlBt7f+CzMY7o/nkN6QCju7ti+sLNINwZp4gET8GXiCQzs6NIcpMMwfaZCOnww6E/q56drS9v1Ls3z/NJA85+07Yr3bt5SPOtJEhjWRkMP08kEELYJdc+0/CAetGGB9+HbEK09FRFjwdCXA33g8Y9i29vqEAL68mht0r6fSyZg9Y1yTzfKOJpd9iN1hnuJt6LKp9iP/XO5w4De4XC49oYfNFvWm+3zL0eCjvYD32H2ArhbEnev3OTLx6ch1G+wfqOpzsd9SlVxyFQc4bZfZ2fS+SK/b7NX7XQ01q+WXO/epAtOb5C0ve0PQbG26eJSLmm6RaCsTe75zi1GrX6TAUCytDh1qM5v90Zvqrbb6+kF1+22avSr+61c47QP/2EsHMT1axB1i8Zba7eGsM0UEGMAxjF83/P4TuA2+5M8FECcwKaGb6As67GOQ9i2MCc+tCGeloUmAocEmHxQKgryM1mMP2zBh2WVjtj4vM/tDJweT0pKhEMOzpTFZITztRlCxdkeoUFfYMpDd8cGlhyay3x34YPdFcE1K6A7Dt1U+C7XUjMHp8K3jAQrgsvRRNA2Yl1rqzw9yg/tH6avoQ36LOLM4M4hZAcxhxJkaox2++Bf5zyVXDiNi4aR5UTuUxE4niGOOPQFQTA9SYiUXPH0DQ6RW70kahG0TBvaWRNpbpG7994+hxU6srIE/17XwEtgFbustXFEyW18kcUbAytT0Xek0jjAjIYupSkatMh0OIi//5bWwNGLNaW5VR2rHFh17MH8cVEDiaHJS6Y7Z9HA2MIt3fKqbkuyfUS5PijKw162mPdRY9ggg5Adv2B8bK/+hw1gq6UiPP7/Dmz1AtNJZGrvv4KSGzB6aXq6FfIwFpfqe0H2VCPjOAM17oJlOQBPjvT30dLjSDcakMZPr9wwoO/F9rQ1XRRD/hvvAtxNrOb4hqWR2B7aTRHDaDZQtFXwAqY5KV/W5gYwFYd2KPfx5fIJG/K7P9ej+S6AQYjZoa0ZnrjV/62f0BcARG+FVtqMlk0SdIXtgMAT+ItbclwAt1iyLXisoHVnpkQdUBGKAVY8SjcRwDJOmaooskete42MNY8Xro662HFOzYGkTSrf0HRIwcGAhRo8FQHlDwXrMVqd8eeYajWDQQ2qXwDhiuHTTGA7QlkppWIIfc31/uSB1AwW0PCxeemtnfq1JZhkKYGrsPVDRdbDX4Bbyk7NUqt0pqrTSdv2EN58GEtLbgH12fCnIiz0jdV9UFqnhJB7fSDzb2hNinzNz5W1reNK8fVOCUnm0dGg3H2UK2FRLwS3cDeKp9gcEv0iF+VhzucxCZlUY7nsIKMwzlrprF2V4a7XQmxjjAvYSSsGa+cJ5vIa++RK0+q1sQTcvOZH9T8ewI03+FmZBWLubhIb8yKjmt9f1Pls6NjtF5DpxhzFNXfJ1tnDe3R+1q7P1qR8/OWhLYIvkKyfjAjQy5Upk1KJ3zJbm/WCbf0LQTjHTbvG2lotSyZ5Li+b2Wyzvm3PbL1QUgQZ/g8mTNTWEdwvm1V78fGekHvUrZVxsNI0vlf+tCX9OuymuBZ2ZiShGz3R1jHy1so4MLpK2kAlkmktQy/qjvTMxoJxUYEF10xmb6+4pkzcwGMUxyAI6EipkkIe0tqYPUlM6NkFJwL8F+9Glv/uvPjG9cjuB66+dm3LiXimafbXIUNH+Nt/AGZDmw7V+t4vHDXd26qbldA/+UO4m3NqC7OqX8jCNVfdrJLzP0DFHaQZKexJVHb4ndhff9uqvZexGf00OnvSYXfYZsXzWWTbe/77E9WOfq4ndV2cDv84qv/B/zH8D3OHxzhj1luJAAAAAElFTkSuQmCC",this.ctx.drawImage(t,0-this.state.localOrigin.x,0-this.state.localOrigin.y,this.state.width,this.state.height),v(s(o.prototype),"doRender",this).call(this)}}]),o}(bn);var xn=function(t){return null==t},On=function(t){a(i,t);var e=h(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,i),o(l(t=e.call(this,r)),"path2D",new Path2D),t}return r(i,[{key:"doRender",value:function(){this.createPathObject(),this.ctx.beginPath(),this.ctx.fill(this.path2D),this.ctx.stroke(this.path2D),v(s(i.prototype),"doRender",this).call(this)}}]),i}(bn),Pn=function(t){a(o,t);var i=h(o);function o(t){return n(this,o),i.call(this,e({dots:[]},t))}return r(o,[{key:"calcOriginalDimension",value:function(){this.calcDots();var t=this.calc4PointsFromDots(),e=t[1].x-t[0].x,n=t[2].y-t[0].y;return this.state.width=e,this.state.height=n,{width:this.state.width,height:this.state.height}}},{key:"calcLocalOrigin",value:function(){for(var t=v(s(o.prototype),"calcLocalOrigin",this).call(this),e=0;e<this.state.dots.length;e++){var n=this.state.dots[e];n=n.matrixTransform(new DOMMatrix([1,0,0,1,-t.x,-t.y])),this.state.dots[e]=n}return t}},{key:"createPathObject",value:function(){this.path2D=new Path2D;for(var t=0;t<this.state.dots.length;t++){var e=this.state.dots[t];0===t?this.path2D.moveTo(e.x,e.y):this.path2D.lineTo(e.x,e.y)}return this.path2D.closePath(),this.path2D}},{key:"calcDots",value:function(){return this.state.dots=[],this.state.dots}},{key:"calc4PointsFromDots",value:function(){for(var t=0,e=0,n=0,i=0,r=0;r<this.state.dots.length;r++){var o=this.state.dots[r];0===r?(t=o.x,n=o.x,e=o.y,i=o.y):(o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<e&&(e=o.y),o.y>i&&(i=o.y))}var a=n,s=e,u=t,l=i,c=n,h=i;return[new DOMPoint(t,e),new DOMPoint(a,s),new DOMPoint(u,l),new DOMPoint(c,h)]}}]),o}(On),Mn=function(t){a(i,t);var e=h(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,i);var r=ln({lineType:"solid",arrow:"none",startPoint:[0,0],endPoint:[10,10]},t);return r=ln(r,{left:t.startPoint[0],top:t.startPoint[1],transform:{translate:[0,0]}}),e.call(this,r)}return r(i,[{key:"calcLocalOrigin",value:function(){var t=new DOMPoint(0,0);return this.state.localOrigin=t,t}},{key:"calcDots",value:function(){return this.state.dots=[new DOMPoint(0,0),new DOMPoint(this.state.endPoint[0]-this.state.startPoint[0],this.state.endPoint[1]-this.state.startPoint[1])],this.state.dots}},{key:"setStartPoint",value:function(t){this.state.startPoint=p(t)}},{key:"setEndPoint",value:function(t){this.state.endPoint=p(t)}},{key:"setState",value:function(t){xn(t.width)||delete t.width,xn(t.height)||delete t.height,v(s(i.prototype),"setState",this).call(this,t)}}]),i}(Pn);var kn=function(t){return"string"==typeof t||!m(t)&&N(t)&&"[object String]"==B(t)},Dn="0.0.1",Cn=function(t){a(o,t);var i=h(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,o),i.call(this,e({width:10,height:10},t))}return r(o,[{key:"calcDots",value:function(){var t=new DOMPoint(0,0),e=new DOMPoint(this.state.width,0),n=new DOMPoint(this.state.width,this.state.height),i=new DOMPoint(0,this.state.height);return this.state.dots=[t,e,n,i],this.state.dots}}]),o}(Pn),An=function(t){a(i,t);var e=h(i);function i(t){var r;return n(this,i),o(l(r=e.call(this,t)),"_targetComponent",void 0),r}return r(i,[{key:"renderChildren",value:function(){this.setControlPositions(),v(s(i.prototype),"renderChildren",this).call(this)}},{key:"moveGlobalPosition",value:function(t,e,n){v(s(i.prototype),"moveGlobalPosition",this).call(this,t,e,n),this._targetComponent&&this._targetComponent.moveGlobalPosition(t,e,n)}}]),i}(function(t){a(i,t);var e=h(i);function i(t){var r;return n(this,i),o(l(r=e.call(this,t)),"parentNode",null),o(l(r),"childNodes",[]),r}return r(i,[{key:"addChild",value:function(t){t.parentNode=this,this.childNodes.push(t)}},{key:"removeChild",value:function(t){t.parentNode=null,t.ctx=null,t.root=null,this.childNodes.splice(this.childNodes.indexOf(t),1)}},{key:"renderChildren",value:function(){var t=this;this.childNodes.forEach((function(e){e.ctx=t.ctx,e.root=t.root,e.render()}))}},{key:"render",value:function(){v(s(i.prototype),"render",this).call(this),this.renderChildren()}}]),i}(Cn)),En=function(t){a(r,t);var i=h(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,r);var o=e({radius:10},t);return o.radiusX=o.radius,o.radiusY=o.radius,i.call(this,o)}return r}(function(t){a(o,t);var i=h(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,o);var r=e({radiusX:20,radiusY:10,rotation:0,startAngle:0,endAngle:2*Math.PI,counterclockwise:!0},t);return r.width=2*r.radiusX,r.height=2*r.radiusY,i.call(this,r)}return r(o,[{key:"createPathObject",value:function(){return this.path2D=new Path2D,this.path2D.ellipse(this.state.radiusX-this.state.localOrigin.x,this.state.radiusY-this.state.localOrigin.y,this.state.radiusX,this.state.radiusY,this.state.rotation,this.state.startAngle,this.state.endAngle,this.state.counterclockwise),this.path2D.closePath(),this.path2D}},{key:"setState",value:function(t){xn(t.radiusX)?xn(t.width)||(t.radiusX=t.width/2):t.width=2*t.radiusX,xn(t.radiusY)?xn(t.height)||(t.radiusY=t.height/2):t.height=2*t.radiusY,v(s(o.prototype),"setState",this).call(this,t)}}]),o}(On)),jn=function(t){a(o,t);var i=h(o);function o(t){var r;return n(this,o),(r=i.call(this,e({position:"start"},t))).on("after-move",r.moveHandler,l(r)),r}return r(o,[{key:"moveHandler",value:function(t){if(this.parentNode){var e=this.props.position;this.parentNode.trigger("before-move",new hn(t,{position:e})),this.parentNode.trigger("after-move",new hn(t,{position:e}))}}}]),o}(En),Sn=function(t){a(s,t);var i=h(s);function s(t){var r;return n(this,s),o(l(r=i.call(this,e(e({},t),{},{zIndex:Number.MAX_VALUE}))),"controlSize",16),o(l(r),"startPointControl",void 0),o(l(r),"endPointControl",void 0),r.initControls(),r.initEvents(),r}return r(s,[{key:"initControls",value:function(){var t=1;this.startPointControl=new jn({zIndex:Number.MAX_VALUE-t++,left:0,top:0,width:this.controlSize,height:this.controlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:"start"}),this.addChild(this.startPointControl),this.endPointControl=new jn({zIndex:Number.MAX_VALUE-t++,left:0,top:0,width:this.controlSize,height:this.controlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:"end"}),this.addChild(this.endPointControl)}},{key:"initEvents",value:function(){this.on("after-move",this.moveEvtHandler,this)}},{key:"setControlPositions",value:function(){if(this.targetComponent){var t=this.targetComponent.state,e=new DOMPoint(t.startPoint[0],t.startPoint[1]),n=new DOMPoint(t.endPoint[0],t.endPoint[1]),i=this.targetComponent.state.composedMatrix;e=e.matrixTransform(i),n=n.matrixTransform(i);var r=this.state.composedMatrix.inverse();e=e.matrixTransform(r),n=n.matrixTransform(r),this.startPointControl.setState({left:e.x,top:e.y}),this.endPointControl.setState({left:n.x,top:n.y})}else{var o=this.state.width,a=this.state.height,s=this.controlSize/2;this.startPointControl.setState({left:-s,top:-s}),this.endPointControl.setState({left:o-s,top:a-s})}}},{key:"moveEvtHandler",value:function(t){if(this.targetComponent){var e=t.position,n=t.movementX/window.devicePixelRatio,i=t.movementY/window.devicePixelRatio,r=this.targetComponent.state,o=r.startPoint[0],a=r.startPoint[1],s=r.endPoint[0],u=r.endPoint[1],l=r.absoluteLinearMatrix.inverse(),c=new DOMPoint(n,i).matrixTransform(l);switch(n=c.x,i=c.y,e){case"start":o-=n,a-=i;break;case"end":s+=n,u+=i}this.targetComponent.setState({startPoint:[o,a],endPoint:[s,u]})}}},{key:"targetComponent",get:function(){return this._targetComponent},set:function(t){if(this._targetComponent=t,t){var e=t.state.absoluteLinearMatrix,n=pn.calcRotateAngle(e),i=t.getMinBoundingBox(),r=i.width,o=i.height,a=i.centerX,s=i.centerY;this.setState({left:a,top:s,width:r,height:o,transform:{rotate:n}})}}}]),s}(An),Tn=function(t){a(o,t);var i=h(o);function o(t){var r;return n(this,o),(r=i.call(this,e({position:"l"},t))).on("after-move",r.resizeEvtHandler,l(r)),r}return r(o,[{key:"resizeEvtHandler",value:function(t){if(this.parentNode){var e=t.movementX/window.devicePixelRatio,n=t.movementY/window.devicePixelRatio,i=this.parentNode.state,r=i.left,o=i.top,a=i.width,s=i.height,u=this.props.position,l=i.absoluteLinearMatrix.inverse(),c=new DOMPoint(e,n).matrixTransform(l);e=c.x,n=c.y;var h=t.clientX,f=t.clientY;this.parentNode.globalCoordToLocal(h,f);-1!=u.indexOf("l")&&(r+=e,a-=2*e),-1!=u.indexOf("r")&&(r-=e,a+=2*e),-1!=u.indexOf("t")&&(o+=n,s-=2*n),-1!=u.indexOf("b")&&(o-=n,s+=2*n);var v={top:o,left:r,width:Math.abs(a),height:Math.abs(s)};this.parentNode.trigger("before-resize",new hn(t,{position:u})),this.parentNode.setState(v),this.parentNode.trigger("after-resize",new hn(t,{position:u}))}}}]),o}(Cn),Bn=function(t){a(i,t);var e=h(i);function i(t){var r;return n(this,i),(r=e.call(this,t)).on("after-move",r.rotateEvtHandler,l(r)),r}return r(i,[{key:"rotateEvtHandler",value:function(t){if(this.parentNode){var e=this.parentNode.state,n=e.absoluteOrigin,i=e.absoluteTranslateMatrix,r=n.matrixTransform(i),o={transform:{rotate:vn.calcRotateAngle(t.clientX,t.clientY,r.x,r.y)+90}};this.parentNode.trigger("before-rotate",new hn(o)),this.parentNode.setState(o),this.parentNode.trigger("after-rotate",new hn(o))}}}]),i}(En),Nn=function(t){a(s,t);var i=h(s);function s(t){var r;return n(this,s),o(l(r=i.call(this,e(e({},t),{},{zIndex:Number.MAX_VALUE}))),"rotateHandleInstance",void 0),o(l(r),"rotateHandleSize",8),o(l(r),"rotateHandleOffsetY",60),o(l(r),"resizeHandleInstanceCache",[]),o(l(r),"resizeHandleSize",16),r.initControls(),r.initEvents(),r}return r(s,[{key:"initControls",value:function(){var t=this,e=1;this.resizeHandleInstanceCache=[];[{position:"tl"},{position:"t"},{position:"tr"},{position:"r"},{position:"rb"},{position:"b"},{position:"lb"},{position:"l"}].forEach((function(n){var i=new Tn({zIndex:Number.MAX_VALUE-e++,left:0,top:0,width:t.resizeHandleSize,height:t.resizeHandleSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:n.position});t.addChild(i),t.resizeHandleInstanceCache.push(i)}));var n=new Bn({zIndex:Number.MAX_VALUE-e++,left:0,top:0,radius:this.rotateHandleSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1}});this.addChild(n),this.rotateHandleInstance=n}},{key:"initEvents",value:function(){this.on("after-resize",this.resizeEvtHandler,this),this.on("after-rotate",this.rotateEvtHandler,this)}},{key:"setControlPositions",value:function(){var t=this.state.width,e=this.state.height,n=t/2,i=e/2,r=this.resizeHandleSize/2,o={tl:new DOMPoint(-r,-r),t:new DOMPoint(n-r,-r),tr:new DOMPoint(t-r,-r),r:new DOMPoint(t-r,i-r),rb:new DOMPoint(t-r,e-r),b:new DOMPoint(n-r,e-r),lb:new DOMPoint(-r,e-r),l:new DOMPoint(-r,i-r)};this.resizeHandleInstanceCache.forEach((function(t){var e=o[t.props.position];t.setState({left:e.x,top:e.y})}));var a=this.state.width/2-this.rotateHandleSize,s=-this.rotateHandleOffsetY,u=new DOMPoint(a,s);this.rotateHandleInstance.setState({left:u.x,top:u.y})}},{key:"rotateEvtHandler",value:function(t){if(this.targetComponent){var e=this.state.transform.rotate;this.targetComponent.setGlobalRotate(e)}}},{key:"resizeEvtHandler",value:function(t){if(this.targetComponent){var e=t.position,n=t.movementX/window.devicePixelRatio,i=t.movementY/window.devicePixelRatio,r=this.targetComponent.state,o=r.left,a=r.top,s=r.width,u=r.height,l=r.absoluteLinearMatrix.inverse(),c=new DOMPoint(n,i).matrixTransform(l);n=c.x,i=c.y,-1!=e.indexOf("l")&&(o+=n,s-=2*n),-1!=e.indexOf("r")&&(o-=n,s+=2*n),-1!=e.indexOf("t")&&(a+=i,u-=2*i),-1!=e.indexOf("b")&&(a-=i,u+=2*i),this.targetComponent.setState({left:o,top:a,width:Math.abs(s),height:Math.abs(u)})}}},{key:"targetComponent",get:function(){return this._targetComponent},set:function(t){if(this._targetComponent=t,t){var e=t.getRotateAngle(),n=t.getLocalLeftTop(),i=n.left,r=n.top,o=n.width,a=n.height;this.setState({left:i,top:r,width:o,height:a,transform:{rotate:e}})}}}]),s}(An),Rn=function(){function t(e){n(this,t),o(this,"ice",void 0),o(this,"transformControlPanel",void 0),o(this,"lineControlPanel",void 0),o(this,"currentDraggingObj",void 0),this.ice=e,this.transformControlPanel=new Nn({left:500,top:100,width:100,height:100,style:{strokeStyle:"#8b0000",fillStyle:"rgba(255, 255, 49, 0.2)",lineWidth:1},transform:{rotate:45}}),this.ice.addToDisplayMap(this.transformControlPanel),this.lineControlPanel=new Sn({left:700,top:50,width:100,height:100,style:{strokeStyle:"rgba(255, 255, 49, 0)",fillStyle:"rgba(255, 255, 49, 0)",lineWidth:1}}),this.ice.addToDisplayMap(this.lineControlPanel)}return r(t,[{key:"mouseDownHandler",value:function(t){var e=t.target;if(console.log(e),!e.state.interactive)return this.ice.rmFromDisplayMap(this.transformControlPanel),void this.ice.rmFromDisplayMap(this.lineControlPanel);var n=e&&(e instanceof An||e.parentNode instanceof An);console.log(e instanceof Mn),n||(t.ctrlKey?this.ice.selectionList.push(e):this.ice.selectionList=[e],e instanceof Mn?this.lineControlPanel.targetComponent=e:this.transformControlPanel.targetComponent=e),this.currentDraggingObj=e instanceof Mn?this.lineControlPanel:this.transformControlPanel,e.parentNode instanceof An&&(this.currentDraggingObj=e),this.ice.evtBus.on("mousemove",this.mouseMoveHandler,this),this.ice.evtBus.on("mouseup",this.mouseUpHandler,this)}},{key:"mouseMoveHandler",value:function(t){var e=t.movementX/window.devicePixelRatio,n=t.movementY/window.devicePixelRatio;return this.currentDraggingObj.moveGlobalPosition(e,n,t),!0}},{key:"mouseUpHandler",value:function(t){this.ice.evtBus.off("mousemove",this.mouseMoveHandler,this),this.ice.evtBus.off("mouseup",this.mouseUpHandler,this)}},{key:"start",value:function(){return this.ice.evtBus.on("mousedown",this.mouseDownHandler,this),this}},{key:"stop",value:function(){}}]),t}();var zn=function(t){return void 0===t},Yn={linear:function(t,e,n,i){return t+(e-t)/n*(Date.now()-i)},easeInQuad:function(t,e,n,i){var r=Date.now()-i;return t+(e-t)/n*(r/n)*r}},Un=function(){function t(e){n(this,t),o(this,"animationMap",new Map),o(this,"ice",void 0),this.ice=e}return r(t,[{key:"start",value:function(){var t=this;return this.ice.evtBus.on(yn,(function(e){t.animationMap.forEach((function(e){e.state.interactive=!1,t.tween(e),e.state.interactive=!0}))})),this}},{key:"tween",value:function(t){var n={},i=t.props.animations,r=1;for(var o in i){var a=i[o];if(a.finished){if(++r===Object.keys(i).length){this.remove(t);break}}else{var s=a.from,u=a.to,l=a.duration;zn(a.startTime)&&(a.startTime=Date.now()),zn(a.easing)&&(a.easing="linear");var c=Yn[a.easing](s,u,l,a.startTime);c>u&&(c=u,a.finished=!0),n[o]=Math.floor(c)}}return t.setState(e({},n)),t}},{key:"add",value:function(t){this.animationMap.set(t.props.id,t)}},{key:"remove",value:function(t){kn(t)?this.animationMap.delete(t):this.animationMap.delete(t.props.id)}},{key:"stop",value:function(){}}]),t}(),In={evtBuses:[],frameCallback:function(){In.evtBuses.forEach((function(t){t.trigger(yn)})),cn.requestAnimationFrame(In.frameCallback)},start:function(){cn.requestAnimationFrame(In.frameCallback)},stop:function(){},pause:function(){},resume:function(){},regitserEvtBus:function(t){In.evtBuses.includes(t)||In.evtBuses.push(t)},delEvtBus:function(t){In.evtBuses.includes(t)&&In.evtBuses.splice(In.evtBuses.indexOf(t),1)}},_n=[["click","ICE_CLICK"],["dbclick","ICE_DBCLICK"],["mousedown","ICE_MOUSEDOWN"],["mouseup","ICE_MOUSEUP"],["mousemove","ICE_MOUSEMOVE"],["mouseenter","ICE_MOUSEENTER"],["mouseleave","ICE_MOUSELEAVE"],["mouseout","ICE_MOUSEOUT"],["mouseover","ICE_MOUSEOVER"],["contextmenu","ICE_CONTEXTMENU"],["mousewheel","ICE_MOUSEWHEEL"]],Fn=function(){function t(e){n(this,t),o(this,"selectionCandidates",[]),o(this,"ice",void 0),this.ice=e}return r(t,[{key:"start",value:function(){var t=this;return _n.forEach((function(e){t.ice.evtBus.on(e[1],(function(n){var i=t.findTargetComponent(n.clientX,n.clientY);i&&(n.target=i,i.trigger(e[0],n)),t.ice.evtBus.trigger(e[0],n)}))})),this}},{key:"findTargetComponent",value:function(t,e){for(var n=t-this.ice.canvasBoundingClientRect.left,i=e-this.ice.canvasBoundingClientRect.top,r=Array.from(this.ice.displayMap.values()),o=0;o<r.length;o++){var a=r[o];this.traverse(n,i,a)}this.selectionCandidates.sort((function(t,e){return t.zIndex-e.zIndex}));var s=this.selectionCandidates[0];return this.selectionCandidates=[],s}},{key:"traverse",value:function(t,e,n){var i=this;n.childNodes&&n.childNodes.length&&n.childNodes.forEach((function(n){i.traverse(t,e,n)})),n.getMinBoundingBox().containsPoint(new DOMPoint(t,e))&&n.state.interactive&&this.selectionCandidates.push(n)}}]),t}(),Ln=function(t){a(i,t);var e=h(i);function i(){return n(this,i),e.call(this)}return i}(fn),Xn={evtBuses:[],start:function(){cn&&cn&&cn.addEventListener&&Xn.evtBuses.forEach((function(t){_n.forEach((function(e){cn.addEventListener(e[0],(function(n){t.trigger(e[1],n)}))}))}))},regitserEvtBus:function(t){Xn.evtBuses.includes(t)||Xn.evtBuses.push(t)},delEvtBus:function(t){Xn.evtBuses.includes(t)&&Xn.evtBuses.splice(Xn.evtBuses.indexOf(t),1)}},Hn=function(){function t(e){n(this,t),o(this,"ice",void 0),this.ice=e}return r(t,[{key:"start",value:function(){var t=this;return this.ice.evtBus.on(yn,(function(e){if(t.ice.ctx.clearRect(0,0,t.ice.canvasWidth,t.ice.canvasHeight),t.ice.displayMap&&t.ice.displayMap.size){var n=Array.from(t.ice.displayMap,(function(t){var e=d(t,2);e[0];return e[1]}));n.sort((function(t,e){return t.state.zIndex-e.state.zIndex})),n.forEach((function(t){!t.isRendering&&t.render()}))}})),this}},{key:"stop",value:function(){throw new Error("Method not implemented.")}}]),t}();In.start();let Gn=(new(function(){function t(){n(this,t),o(this,"version",Dn),o(this,"displayMap",new Map),o(this,"evtBus",void 0),o(this,"root",void 0),o(this,"ctx",void 0),o(this,"canvasEl",void 0),o(this,"canvasWidth",0),o(this,"canvasHeight",0),o(this,"canvasBoundingClientRect",void 0),o(this,"selectionList",[]),o(this,"animationManager",void 0),o(this,"eventBridge",void 0),o(this,"controlManager",void 0),o(this,"renderer",void 0)}return r(t,[{key:"init",value:function(t){if(!t)throw new Error("init() failed...");if(this.ctx===t)throw new Error("同一个 canvas 实例只能 init 一次...");return this.root=cn,kn(t)?(this.canvasEl=this.root.document.getElementById(t),this.canvasEl.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.canvasWidth=this.canvasEl.width,this.canvasHeight=this.canvasEl.height,this.canvasBoundingClientRect=this.canvasEl.getBoundingClientRect(),this.ctx=this.canvasEl.getContext("2d")):this.ctx=t,this.evtBus=new Ln,In.regitserEvtBus(this.evtBus),Xn.regitserEvtBus(this.evtBus),Xn.start(),this.animationManager=new Un(this).start(),this.eventBridge=new Fn(this).start(),this.controlManager=new Rn(this).start(),this.renderer=new Hn(this).start(),this}},{key:"destory",value:function(){}},{key:"addToDisplayMap",value:function(t){t.ctx=this.ctx,t.root=this.root,this.displayMap.set(t.props.id,t),Object.keys(t.props.animations).length&&this.animationManager.add(t)}},{key:"rmFromDisplayMap",value:function(t){this.displayMap.delete(t.props.id),t.ctx=null,t.root=null}},{key:"clearRenderMap",value:function(){}},{key:"toJSON",value:function(){return"{}"}},{key:"fromJSON",value:function(t){return{}}}]),t}())).init("canvas-1"),qn=new Mn({left:0,top:0,startPoint:[100,100],endPoint:[300,300],style:{strokeStyle:"#7700e6",fillStyle:"#008000",lineWidth:5},transform:{}});Gn.addToDisplayMap(qn);let Vn=new wn({left:100,top:500,width:100,height:100,transform:{rotate:45,scale:[1,2]}});Gn.addToDisplayMap(Vn)}));
