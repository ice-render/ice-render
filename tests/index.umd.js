!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function e(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=a(t);if(e){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}function v(){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=f(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var x=function(){this.__data__=[],this.size=0};var m=function(t,e){return t===e||t!=t&&e!=e};var w=function(t,e){for(var n=t.length;n--;)if(m(t[n][0],e))return n;return-1},P=Array.prototype.splice;var b=function(t){var e=this.__data__,n=w(e,t);return!(n<0)&&(n==e.length-1?e.pop():P.call(e,n,1),--this.size,!0)};var k=function(t){var e=this.__data__,n=w(e,t);return n<0?void 0:e[n][1]};var M=function(t){return w(this.__data__,t)>-1};var O=function(t,e){var n=this.__data__,i=w(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this};function C(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}C.prototype.clear=x,C.prototype.delete=b,C.prototype.get=k,C.prototype.has=M,C.prototype.set=O;var D=C;var _=function(){this.__data__=new D,this.size=0};var E=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var S=function(t){return this.__data__.get(t)};var j=function(t){return this.__data__.has(t)},B="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function A(t,e){return t(e={exports:{}},e.exports),e.exports}var R="object"==typeof B&&B&&B.Object===Object&&B,T="object"==typeof self&&self&&self.Object===Object&&self,N=R||T||Function("return this")(),z=N.Symbol,I=Object.prototype,L=I.hasOwnProperty,H=I.toString,q=z?z.toStringTag:void 0;var U=function(t){var e=L.call(t,q),n=t[q];try{t[q]=void 0;var i=!0}catch(t){}var r=H.call(t);return i&&(e?t[q]=n:delete t[q]),r},X=Object.prototype.toString;var W=function(t){return X.call(t)},Y=z?z.toStringTag:void 0;var F=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Y&&Y in Object(t)?U(t):W(t)};var V=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var $,G=function(t){if(!V(t))return!1;var e=F(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},J=N["__core-js_shared__"],K=($=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"";var Q=function(t){return!!K&&K in t},Z=Function.prototype.toString;var tt=function(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""},et=/^\[object .+?Constructor\]$/,nt=Function.prototype,it=Object.prototype,rt=nt.toString,ot=it.hasOwnProperty,st=RegExp("^"+rt.call(ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var at=function(t){return!(!V(t)||Q(t))&&(G(t)?st:et).test(tt(t))};var ht=function(t,e){return null==t?void 0:t[e]};var ut=function(t,e){var n=ht(t,e);return at(n)?n:void 0},lt=ut(N,"Map"),ct=ut(Object,"create");var ft=function(){this.__data__=ct?ct(null):{},this.size=0};var vt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},dt=Object.prototype.hasOwnProperty;var yt=function(t){var e=this.__data__;if(ct){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return dt.call(e,t)?e[t]:void 0},pt=Object.prototype.hasOwnProperty;var gt=function(t){var e=this.__data__;return ct?void 0!==e[t]:pt.call(e,t)};var xt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ct&&void 0===e?"__lodash_hash_undefined__":e,this};function mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}mt.prototype.clear=ft,mt.prototype.delete=vt,mt.prototype.get=yt,mt.prototype.has=gt,mt.prototype.set=xt;var wt=mt;var Pt=function(){this.size=0,this.__data__={hash:new wt,map:new(lt||D),string:new wt}};var bt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var kt=function(t,e){var n=t.__data__;return bt(e)?n["string"==typeof e?"string":"hash"]:n.map};var Mt=function(t){var e=kt(this,t).delete(t);return this.size-=e?1:0,e};var Ot=function(t){return kt(this,t).get(t)};var Ct=function(t){return kt(this,t).has(t)};var Dt=function(t,e){var n=kt(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this};function _t(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}_t.prototype.clear=Pt,_t.prototype.delete=Mt,_t.prototype.get=Ot,_t.prototype.has=Ct,_t.prototype.set=Dt;var Et=_t;var St=function(t,e){var n=this.__data__;if(n instanceof D){var i=n.__data__;if(!lt||i.length<199)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new Et(i)}return n.set(t,e),this.size=n.size,this};function jt(t){var e=this.__data__=new D(t);this.size=e.size}jt.prototype.clear=_,jt.prototype.delete=E,jt.prototype.get=S,jt.prototype.has=j,jt.prototype.set=St;var Bt=jt,At=function(){try{var t=ut(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Rt=function(t,e,n){"__proto__"==e&&At?At(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var Tt=function(t,e,n){(void 0!==n&&!m(t[e],n)||void 0===n&&!(e in t))&&Rt(t,e,n)};var Nt=function(t){return function(e,n,i){for(var r=-1,o=Object(e),s=i(e),a=s.length;a--;){var h=s[t?a:++r];if(!1===n(o[h],h,o))break}return e}}(),zt=A((function(t,e){var n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,r=i&&i.exports===n?N.Buffer:void 0,o=r?r.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,i=o?o(n):new t.constructor(n);return t.copy(i),i}})),It=N.Uint8Array;var Lt=function(t){var e=new t.constructor(t.byteLength);return new It(e).set(new It(t)),e};var Ht=function(t,e){var n=e?Lt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var qt=function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e},Ut=Object.create,Xt=function(){function t(){}return function(e){if(!V(e))return{};if(Ut)return Ut(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var Wt=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object),Yt=Object.prototype;var Ft=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Yt)};var Vt=function(t){return"function"!=typeof t.constructor||Ft(t)?{}:Xt(Wt(t))};var $t=function(t){return null!=t&&"object"==typeof t};var Gt=function(t){return $t(t)&&"[object Arguments]"==F(t)},Jt=Object.prototype,Kt=Jt.hasOwnProperty,Qt=Jt.propertyIsEnumerable,Zt=Gt(function(){return arguments}())?Gt:function(t){return $t(t)&&Kt.call(t,"callee")&&!Qt.call(t,"callee")},te=Array.isArray;var ee=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var ne=function(t){return null!=t&&ee(t.length)&&!G(t)};var ie=function(t){return $t(t)&&ne(t)};var re=function(){return!1},oe=A((function(t,e){var n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,r=i&&i.exports===n?N.Buffer:void 0,o=(r?r.isBuffer:void 0)||re;t.exports=o})),se=Function.prototype,ae=Object.prototype,he=se.toString,ue=ae.hasOwnProperty,le=he.call(Object);var ce=function(t){if(!$t(t)||"[object Object]"!=F(t))return!1;var e=Wt(t);if(null===e)return!0;var n=ue.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&he.call(n)==le},fe={};fe["[object Float32Array]"]=fe["[object Float64Array]"]=fe["[object Int8Array]"]=fe["[object Int16Array]"]=fe["[object Int32Array]"]=fe["[object Uint8Array]"]=fe["[object Uint8ClampedArray]"]=fe["[object Uint16Array]"]=fe["[object Uint32Array]"]=!0,fe["[object Arguments]"]=fe["[object Array]"]=fe["[object ArrayBuffer]"]=fe["[object Boolean]"]=fe["[object DataView]"]=fe["[object Date]"]=fe["[object Error]"]=fe["[object Function]"]=fe["[object Map]"]=fe["[object Number]"]=fe["[object Object]"]=fe["[object RegExp]"]=fe["[object Set]"]=fe["[object String]"]=fe["[object WeakMap]"]=!1;var ve=function(t){return $t(t)&&ee(t.length)&&!!fe[F(t)]};var de=function(t){return function(e){return t(e)}},ye=A((function(t,e){var n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,r=i&&i.exports===n&&R.process,o=function(){try{var t=i&&i.require&&i.require("util").types;return t||r&&r.binding&&r.binding("util")}catch(t){}}();t.exports=o})),pe=ye&&ye.isTypedArray,ge=pe?de(pe):ve;var xe=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},me=Object.prototype.hasOwnProperty;var we=function(t,e,n){var i=t[e];me.call(t,e)&&m(i,n)&&(void 0!==n||e in t)||Rt(t,e,n)};var Pe=function(t,e,n,i){var r=!n;n||(n={});for(var o=-1,s=e.length;++o<s;){var a=e[o],h=i?i(n[a],t[a],a,n,t):void 0;void 0===h&&(h=t[a]),r?Rt(n,a,h):we(n,a,h)}return n};var be=function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i},ke=/^(?:0|[1-9]\d*)$/;var Me=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&ke.test(t))&&t>-1&&t%1==0&&t<e},Oe=Object.prototype.hasOwnProperty;var Ce=function(t,e){var n=te(t),i=!n&&Zt(t),r=!n&&!i&&oe(t),o=!n&&!i&&!r&&ge(t),s=n||i||r||o,a=s?be(t.length,String):[],h=a.length;for(var u in t)!e&&!Oe.call(t,u)||s&&("length"==u||r&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Me(u,h))||a.push(u);return a};var De=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},_e=Object.prototype.hasOwnProperty;var Ee=function(t){if(!V(t))return De(t);var e=Ft(t),n=[];for(var i in t)("constructor"!=i||!e&&_e.call(t,i))&&n.push(i);return n};var Se=function(t){return ne(t)?Ce(t,!0):Ee(t)};var je=function(t){return Pe(t,Se(t))};var Be=function(t,e,n,i,r,o,s){var a=xe(t,n),h=xe(e,n),u=s.get(h);if(u)Tt(t,n,u);else{var l=o?o(a,h,n+"",t,e,s):void 0,c=void 0===l;if(c){var f=te(h),v=!f&&oe(h),d=!f&&!v&&ge(h);l=h,f||v||d?te(a)?l=a:ie(a)?l=qt(a):v?(c=!1,l=zt(h,!0)):d?(c=!1,l=Ht(h,!0)):l=[]:ce(h)||Zt(h)?(l=a,Zt(a)?l=je(a):V(a)&&!G(a)||(l=Vt(h))):c=!1}c&&(s.set(h,l),r(l,h,i,o,s),s.delete(h)),Tt(t,n,l)}};var Ae=function t(e,n,i,r,o){e!==n&&Nt(n,(function(s,a){if(o||(o=new Bt),V(s))Be(e,n,a,i,t,r,o);else{var h=r?r(xe(e,a),s,a+"",e,n,o):void 0;void 0===h&&(h=s),Tt(e,a,h)}}),Se)};var Re=function(t){return t};var Te=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},Ne=Math.max;var ze=function(t,e,n){return e=Ne(void 0===e?t.length-1:e,0),function(){for(var i=arguments,r=-1,o=Ne(i.length-e,0),s=Array(o);++r<o;)s[r]=i[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=i[r];return a[e]=n(s),Te(t,this,a)}};var Ie=function(t){return function(){return t}},Le=At?function(t,e){return At(t,"toString",{configurable:!0,enumerable:!1,value:Ie(e),writable:!0})}:Re,He=Date.now;var qe=function(t){var e=0,n=0;return function(){var i=He(),r=16-(i-n);if(n=i,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Le);var Ue=function(t,e){return qe(ze(t,e,Re),t+"")};var Xe=function(t,e,n){if(!V(n))return!1;var i=typeof e;return!!("number"==i?ne(n)&&Me(e,n.length):"string"==i&&e in n)&&m(n[e],t)};var We=function(t){return Ue((function(e,n){var i=-1,r=n.length,o=r>1?n[r-1]:void 0,s=r>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(r--,o):void 0,s&&Xe(n[0],n[1],s)&&(o=r<3?void 0:o,r=1),e=Object(e);++i<r;){var a=n[i];a&&t(e,a,i,o)}return e}))}((function(t,e,n){Ae(t,e,n)}));function Ye(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(n){"constructor"!=n&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))}))}))}var Fe="ICE_FRAME_EVENT",Ve="BEFORE_RENDER",$e="AFTER_RENDER",Ge="BEFORE_ADD",Je="AFTER_ADD",Ke="BEFORE_REMOVE",Qe="AFTER_REMOVE";var Ze=function(t){return"symbol"==typeof t||$t(t)&&"[object Symbol]"==F(t)},tn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,en=/^\w*$/;var nn=function(t,e){if(te(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Ze(t))||(en.test(t)||!tn.test(t)||null!=e&&t in Object(e))};function rn(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var s=t.apply(this,i);return n.cache=o.set(r,s)||o,s};return n.cache=new(rn.Cache||Et),n}rn.Cache=Et;var on=rn;var sn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,an=/\\(\\)?/g,hn=function(t){var e=on(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(sn,(function(t,n,i,r){e.push(i?r.replace(an,"$1"):n||t)})),e}));var un=function(t,e){for(var n=-1,i=null==t?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r},ln=z?z.prototype:void 0,cn=ln?ln.toString:void 0;var fn=function t(e){if("string"==typeof e)return e;if(te(e))return un(e,t)+"";if(Ze(e))return cn?cn.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n};var vn=function(t){return null==t?"":fn(t)};var dn=function(t,e){return te(t)?t:nn(t,e)?[t]:hn(vn(t))};var yn=function(t){if("string"==typeof t||Ze(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var pn=function(t,e){for(var n=0,i=(e=dn(e,t)).length;null!=t&&n<i;)t=t[yn(e[n++])];return n&&n==i?t:void 0};var gn=function(t,e,n){var i=null==t?void 0:pn(t,e);return void 0===i?n:i},xn=window||global||{},mn=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in n(this,t),o(this,"originalEvent",void 0),o(this,"target",void 0),e)this[r]=e[r];for(var s in i)this[s]=i[s]},wn=function(){function t(){n(this,t),o(this,"listeners",{}),o(this,"suspendedEventNames",[])}return r(t,[{key:"on",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xn;this.listeners[t]||(this.listeners[t]=[]),this.off(t,e,n),this.listeners[t].push({callback:e,scope:n})}},{key:"off",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xn,i=this.listeners[t];if(i)for(var r=0;r<i.length;r++){var o=i[r];if(o.callback===e&&o.scope===n)return void this.listeners[t].splice(r,1)}}},{key:"once",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xn;function i(r){this.off(t,i,n),e.call(n,r)}this.on(t,i,n)}},{key:"trigger",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!!this.listeners[t]&&(!this.suspendedEventNames.includes(t)&&(n?(e=new mn(n)).originalEvent=n:e=new mn({type:t,timeStamp:(new Date).getTime()}),this.listeners[t].forEach((function(t){var n=t.callback,i=t.scope;n.call(i,e)})),!0))}},{key:"suspend",value:function(t,e){t&&!this.suspendedEventNames.includes(t)&&this.suspendedEventNames.push(t),e&&(e.prototype.suspended=!0)}},{key:"resume",value:function(t,e){t&&this.suspendedEventNames.includes(t)&&this.suspendedEventNames.splice(this.suspendedEventNames.findIndex(t),1),e&&(e.prototype.suspended=!1)}},{key:"purge",value:function(){this.listeners={}}}]),t}();wn.prototype.addEventListener=wn.prototype.on,wn.prototype.removeEventListener=wn.prototype.off,wn.prototype.dispatchEvent=wn.prototype.trigger;var Pn=/\s/;var bn=function(t){for(var e=t.length;e--&&Pn.test(t.charAt(e)););return e},kn=/^\s+/;var Mn=function(t){return t?t.slice(0,bn(t)+1).replace(kn,""):t},On=/^[-+]0x[0-9a-f]+$/i,Cn=/^0b[01]+$/i,Dn=/^0o[0-7]+$/i,_n=parseInt;var En=function(t){if("number"==typeof t)return t;if(Ze(t))return NaN;if(V(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=V(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Mn(t);var n=Cn.test(t);return n||Dn.test(t)?_n(t.slice(2),n?2:8):On.test(t)?NaN:+t};var Sn=function(t){return t?(t=En(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var jn=function(t){var e=Sn(t),n=e%1;return e==e?n?e-n:e:0},Bn=N.isFinite,An=Math.min;var Rn=function(t){var e=Math[t];return function(t,n){if(t=En(t),(n=null==n?0:An(jn(n),292))&&Bn(t)){var i=(vn(t)+"e").split("e"),r=e(i[0]+"e"+(+i[1]+n));return+((i=(vn(r)+"e").split("e"))[0]+"e"+(+i[1]-n))}return e(t)}}("round"),Tn=function(){function t(){throw n(this,t),new Error("GeoUtil is a static util class.")}return r(t,null,[{key:"containsPoint",value:function(t,e){return!1}},{key:"isIntersect",value:function(t,e){return!1}},{key:"getLength",value:function(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}},{key:"calcRotateAngle",value:function(t,e,n,i){var r=t-n,o=e-i,s=r/Math.sqrt(r*r+o*o),a=(o/Math.sqrt(r*r+o*o)<0?-1:1)*Math.acos(s)*180/Math.PI+360;return a%=360}},{key:"crossProduct",value:function(t,e,n,i){return Rn(t*i-n*e,2)}},{key:"dotProduct",value:function(t,e,n,i){return Rn(t*n+e*i,2)}}]),t}(),Nn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0,0];n(this,t),o(this,"tl",new DOMPoint),o(this,"tr",new DOMPoint),o(this,"bl",new DOMPoint),o(this,"br",new DOMPoint),o(this,"center",new DOMPoint),this.tl=new DOMPoint(e[0],e[1]),this.tr=new DOMPoint(e[2],e[3]),this.bl=new DOMPoint(e[4],e[5]),this.br=new DOMPoint(e[6],e[7]),this.center=new DOMPoint(e[8],e[9])}return r(t,[{key:"clone",value:function(){var e=DOMPoint.fromPoint(this.tl),n=DOMPoint.fromPoint(this.tr),i=DOMPoint.fromPoint(this.bl),r=DOMPoint.fromPoint(this.br),o=DOMPoint.fromPoint(this.center);return new t([e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y,o.x,o.y])}},{key:"containsPoint",value:function(t){var e=this.getMinAndMaxPoint(),n=e.minX,i=e.minY,r=e.maxX,o=e.maxY;if(t.x<n||t.x>r||t.y<i||t.y>o)return!1;for(var s,a=0,h=this.getBoundingLines(),u=0;u<h.length;u++){var l=h[u];if(!(t.y>l.o.y&&t.y>l.d.y)&&!(t.y<l.o.y&&t.y<l.d.y)){if(l.o.x===l.d.x&&l.o.x>=t.x)s=l.o.x;else{var c=(l.d.y-l.o.y)/(l.d.x-l.o.x);s=l.o.x+(t.y-l.o.y)/c}s>t.x&&a++}}return 0!==a&&a%2==1}},{key:"getBoundingLines",value:function(){return[{o:DOMPoint.fromPoint(this.tl),d:DOMPoint.fromPoint(this.tr)},{o:DOMPoint.fromPoint(this.tr),d:DOMPoint.fromPoint(this.br)},{o:DOMPoint.fromPoint(this.br),d:DOMPoint.fromPoint(this.bl)},{o:DOMPoint.fromPoint(this.bl),d:DOMPoint.fromPoint(this.tl)}]}},{key:"getMinAndMaxPoint",value:function(){var t=this.tl.x,e=this.tl.y,n=this.tl.x,i=this.tl.y;return[this.tr,this.bl,this.br].forEach((function(r){r.x<t&&(t=r.x),r.x>n&&(n=r.x),r.y<e&&(e=r.y),r.y>i&&(i=r.y)})),{minX:t,minY:e,maxX:n,maxY:i}}},{key:"containsBox",value:function(t){return!1}},{key:"isIntersect",value:function(t){var e=this.tl.x,n=this.br.x,i=this.tl.y,r=this.br.y,o=t.tl.x,s=t.br.x,a=t.tl.y,h=t.br.y,u=!(e>s||i>h||n<o||r<a);return u}},{key:"transform",value:function(e){var n=DOMPoint.fromPoint(this.tl).matrixTransform(e),i=DOMPoint.fromPoint(this.tr).matrixTransform(e),r=DOMPoint.fromPoint(this.bl).matrixTransform(e),o=DOMPoint.fromPoint(this.br).matrixTransform(e),s=DOMPoint.fromPoint(this.center).matrixTransform(e);return new t([n.x,n.y,i.x,i.y,r.x,r.y,o.x,o.y,s.x,s.y])}},{key:"union",value:function(t){return null}},{key:"width",get:function(){return Tn.getLength(this.br.x,this.br.y,this.bl.x,this.bl.y)}},{key:"height",get:function(){return Tn.getLength(this.br.x,this.br.y,this.tr.x,this.tr.y)}},{key:"left",get:function(){return this.tl.x},set:function(t){throw new Error("Can not set left to ICEBoundingBox directly.")}},{key:"top",get:function(){return this.tl.y},set:function(t){throw new Error("Can not set top to ICEBoundingBox directly.")}},{key:"centerX",get:function(){return this.center.x}},{key:"centerY",get:function(){return this.center.y}},{key:"centerPoint",get:function(){return this.center}}],[{key:"fromDimension",value:function(e,n,i,r){return new t([].concat([e,n],[e+i,n],[e,n+r],[e+i,n+r],[e+i/2,n+r/2]))}}]),t}(),zn=function(){function t(){n(this,t)}return r(t,null,[{key:"calcRotateAngleFromMatrix",value:function(t){var e=0,n=t.a,i=t.b,r=i/Math.sqrt(n*n+i*i),o=n/Math.sqrt(n*n+i*i);return e=Math.acos(o),r<0&&(e+=Math.PI/2),e*(180/Math.PI)}},{key:"calcScaleFromMatrix",value:function(t){return[Math.sqrt(t.a*t.a+t.b*t.b)/t.a,Math.sqrt(t.c*t.c+t.d*t.d)/t.d]}}]),t}(),In=function(t){s(a,t);var i=c(a);function a(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,a),o(u(t=i.call(this)),"root",void 0),o(u(t),"ctx",void 0),o(u(t),"evtBus",void 0),o(u(t),"parentNode",void 0),o(u(t),"props",{id:"ICE_"+Math.floor(1e10*Math.random()),left:0,top:0,width:0,height:0,style:{fillStyle:"red",strokeStyle:"blue",lineWidth:1},animations:{},transform:{translate:[0,0],scale:[1,1],skew:[0,0],rotate:0},translationMatrix:new DOMMatrix,linearMatrix:new DOMMatrix,composedMatrix:new DOMMatrix,origin:"localCenter",localOrigin:new DOMPoint(0,0),absoluteOrigin:new DOMPoint(0,0),zIndex:a.instanceCounter++,isRendering:!1,display:!0,draggable:!0,transformable:!0,linkable:!0,interactive:!0,showMinBoundingBox:!0,showMaxBoundingBox:!0}),o(u(t),"state",e({},t.props)),t.props=We(t.props,r),t.state=JSON.parse(JSON.stringify(t.props)),t.initEvents(),t}return r(a,[{key:"render",value:function(){this.state.isRendering=!0,this.calcOriginalDimension(),this.applyStyle(),this.applyTransformToCtx(),this.doRender(),this.ctx.setTransform(new DOMMatrix),this.state.isRendering=!1}},{key:"applyStyle",value:function(){Object.assign(this.ctx,e(e({},this.props.style),this.state.style))}},{key:"calcOriginalDimension",value:function(){return{width:this.state.width,height:this.state.height}}},{key:"calcLocalOrigin",value:function(){var t=new DOMPoint(0,0),e=this.state.origin;if(!e||"localCenter"===e){var n=this.state.width/2,i=this.state.height/2;t.x=n,t.y=i}return this.state.localOrigin=t,t}},{key:"calcAbsoluteOrigin",value:function(){var t=gn(this,"state.transform.translate.0")+this.state.left,e=gn(this,"state.transform.translate.1")+this.state.top,n=DOMPoint.fromPoint(this.calcLocalOrigin());if(n.x+=t,n.y+=e,this.parentNode){var i=this.parentNode.state.localOrigin.x,r=this.parentNode.state.localOrigin.y;n=n.matrixTransform(new DOMMatrix([1,0,0,1,-i,-r]));var o=this.parentNode.state.composedMatrix;n=n.matrixTransform(o)}return this.state.absoluteOrigin=n,n}},{key:"calcLinearMatrix",value:function(){var t=new DOMMatrix,e=gn(this,"state.transform.skew.0"),n=gn(this,"state.transform.skew.1");t.skewXSelf(e),t.skewYSelf(n);var i=gn(this,"state.transform.rotate");t.rotateSelf(i);var r=gn(this,"state.transform.scale.0"),o=gn(this,"state.transform.scale.1");return t.scaleSelf(r,o),this.state.linearMatrix=t,t}},{key:"calcAbsoluteLinearMatrix",value:function(){for(var t=this,e=DOMMatrix.fromMatrix(t.calcLinearMatrix());t.parentNode;)e.multiplySelf(t.parentNode.state.linearMatrix),t=t.parentNode;return this.state.absoluteLinearMatrix=DOMMatrix.fromMatrix(e),e}},{key:"composeMatrix",value:function(){var t=this.calcAbsoluteOrigin(),e=new DOMMatrix([1,0,0,1,t.x,t.y]),n=this.calcAbsoluteLinearMatrix(),i=e.multiplySelf(n);return this.state.composedMatrix=DOMMatrix.fromMatrix(i),i}},{key:"applyTransformToCtx",value:function(){this.ctx.setTransform(this.composeMatrix())}},{key:"doRender",value:function(){if(this.state.showMinBoundingBox){var t=this.getMinBoundingBox();this.ctx.setTransform(new DOMMatrix),this.ctx.lineWidth=1,this.ctx.strokeStyle="#ff0000",this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.beginPath(),this.ctx.moveTo(t.tl.x,t.tl.y),this.ctx.lineTo(t.tr.x,t.tr.y),this.ctx.lineTo(t.br.x,t.br.y),this.ctx.lineTo(t.bl.x,t.bl.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill()}if(this.state.showMaxBoundingBox){var e=this.getMaxBoundingBox();this.ctx.setTransform(new DOMMatrix),this.ctx.lineWidth=1,this.ctx.strokeStyle="#0000ff",this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.beginPath(),this.ctx.moveTo(e.tl.x,e.tl.y),this.ctx.lineTo(e.tr.x,e.tr.y),this.ctx.lineTo(e.br.x,e.br.y),this.ctx.lineTo(e.bl.x,e.bl.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill()}}},{key:"getMinBoundingBox",value:function(){var t=this.state.localOrigin.x,e=this.state.localOrigin.y,n=this.state.width,i=this.state.height,r=new Nn([0-t,0-e,0-t+n,0-e,0-t,0-e+i,0-t+n,0-e+i,0,0]);return r=r.transform(this.state.composedMatrix)}},{key:"getMaxBoundingBox",value:function(){var t=this.getMinBoundingBox(),e=t.getMinAndMaxPoint(),n=e.minX,i=e.minY,r=e.maxX,o=e.maxY,s=t.centerPoint;return t=new Nn([n,i,r,i,n,o,r,o,s.x,s.y])}},{key:"setState",value:function(t){We(this.state,t)}},{key:"setPosition",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mn;this.trigger("before-move",e(e({},i),{},{left:t,top:n})),this.setState({left:t,top:n}),this.trigger("after-move",e(e({},i),{},{left:t,top:n}))}},{key:"moveGlobalPosition",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mn;if(this.parentNode){var r=new DOMPoint(t,n),o=this.parentNode.state.absoluteLinearMatrix.inverse();t=(r=r.matrixTransform(o)).x,n=r.y}this.setPosition(this.state.left+t,this.state.top+n,e(e({},i),{},{tx:t,ty:n}))}},{key:"setGlobalRotate",value:function(t){if(this.parentNode){var e=this.parentNode.state.absoluteLinearMatrix;t-=zn.calcRotateAngleFromMatrix(e)}this.setState({transform:{rotate:t}})}},{key:"localCoordToGlobal",value:function(t,e){var n=new DOMPoint(t,e),i=this.state.composedMatrix;return n=n.matrixTransform(i)}},{key:"globalCoordToLocal",value:function(t,e){var n=new DOMPoint(t,e),i=this.state.composedMatrix.inverse();return n=n.matrixTransform(i)}},{key:"getRotateAngle",value:function(){var t=this.state.composedMatrix;return zn.calcRotateAngleFromMatrix(t)}},{key:"getLocalLeftTop",value:function(){var t=this.getMinBoundingBox(),e=t.width,n=t.height;return{left:t.centerX-t.width/2,top:t.centerY-t.height/2,width:e,height:n}}},{key:"toJSON",value:function(){return"{}"}},{key:"fromJSON",value:function(t){return{}}},{key:"destory",value:function(){}}]),a}(wn);o(In,"instanceCounter",0);var Ln=function(t){s(h,t);var i=c(h);function h(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,h),o(u(t=i.call(this,e({closePath:!0},r))),"path2D",new Path2D),t}return r(h,[{key:"initEvents",value:function(){}},{key:"doRender",value:function(){this.createPathObject(),this.ctx.beginPath(),this.state.closePath&&this.ctx.fill(this.path2D),this.ctx.stroke(this.path2D),v(a(h.prototype),"doRender",this).call(this)}}]),h}(In),Hn=function(t){s(o,t);var i=c(o);function o(t){return n(this,o),i.call(this,e({dots:[],closePath:!0},t))}return r(o,[{key:"calcOriginalDimension",value:function(){this.calcDots();var t=this.calc4VertexPoints(),e=Math.abs(t[1].x-t[0].x),n=Math.abs(t[2].y-t[0].y);return this.state.width=e,this.state.height=n,{width:this.state.width,height:this.state.height}}},{key:"calcLocalOrigin",value:function(){for(var t=v(a(o.prototype),"calcLocalOrigin",this).call(this),e=0;e<this.state.dots.length;e++){var n=this.state.dots[e];n=n.matrixTransform(new DOMMatrix([1,0,0,1,-t.x,-t.y])),this.state.dots[e]=n}return t}},{key:"createPathObject",value:function(){this.path2D=new Path2D;for(var t=0;t<this.state.dots.length;t++){var e=this.state.dots[t];0===t?this.path2D.moveTo(e.x,e.y):this.path2D.lineTo(e.x,e.y)}return this.state.closePath&&this.path2D.closePath(),this.path2D}},{key:"calcDots",value:function(){return this.state.dots=[],this.state.dots}},{key:"calc4VertexPoints",value:function(){for(var t=0,e=0,n=0,i=0,r=0;r<this.state.dots.length;r++){var o=this.state.dots[r];0===r?(t=o.x,n=o.x,e=o.y,i=o.y):(o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<e&&(e=o.y),o.y>i&&(i=o.y))}var s=n,a=e,h=t,u=i,l=n,c=i;return[new DOMPoint(t,e),new DOMPoint(s,a),new DOMPoint(h,u),new DOMPoint(l,c)]}}]),o}(Ln),qn=function(t){s(o,t);var i=c(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,o),i.call(this,e({width:10,height:10},t))}return r(o,[{key:"calcDots",value:function(){var t=new DOMPoint(0,0),e=new DOMPoint(this.state.width,0),n=new DOMPoint(this.state.width,this.state.height),i=new DOMPoint(0,this.state.height);return this.state.dots=[t,e,n,i],this.state.dots}}]),o}(Hn),Un=function(t){s(i,t);var e=c(i);function i(t){var r;return n(this,i),o(u(r=e.call(this,t)),"parentNode",null),o(u(r),"childNodes",[]),r}return r(i,[{key:"addChild",value:function(t){t.trigger(Ge),t.parentNode=this,this.childNodes.push(t),t.trigger(Je)}},{key:"addChildren",value:function(t){var e=this;t.forEach((function(t){e.addChild(t)}))}},{key:"removeChild",value:function(t){t.trigger(Ke),t.parentNode=null,t.root=null,t.ctx=null,t.evtBus=null,this.childNodes.splice(this.childNodes.indexOf(t),1),t.trigger(Qe)}},{key:"removeChildren",value:function(t){var e=this;t.forEach((function(t){e.removeChild(t)}))}},{key:"renderChildren",value:function(){var t=this;this.childNodes.forEach((function(e){e.root=t.root,e.ctx=t.ctx,e.evtBus=t.evtBus,e.trigger(Ve),e.state.isRendering||e.state.display&&(e.render(),e.trigger($e))}))}},{key:"render",value:function(){v(a(i.prototype),"render",this).call(this),this.renderChildren()}}]),i}(qn),Xn=function(t){s(i,t);var e=c(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,i),e.call(this,t)}return i}(Un),Wn=function(){function t(){n(this,t),o(this,"startHook",void 0),o(this,"endHook",void 0),o(this,"hookRadius",10)}return r(t,[{key:"createLinkHooks",value:function(){}},{key:"setHookPositions",value:function(){}}]),t}();var Yn=function(t){return null==t},Fn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=e,this.y=i}return r(t,[{key:"toArray",value:function(){return[this.x,this.y]}},{key:"transform",value:function(t){var e=this.x,n=this.y;this.x=t[0][0]*e+t[0][1]*n+t[0][2],this.y=t[1][0]*e+t[1][1]*n+t[1][2]}},{key:"equals",value:function(t){return this.x==t.x&&this.y==t.y}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"add",value:function(t){return this.x=this.x+t.x,this.y=this.y+t.y,this}},{key:"near",value:function(t,e,n){return Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-e,2))<=n}},{key:"toString",value:function(){return"["+this.x+","+this.y+"]"}}],[{key:"load",value:function(e){return new t(Number(e.x),Number(e.y))}},{key:"loadArray",value:function(e){for(var n=[],i=0;i<e.length;i++)n.push(t.load(e[i]));return n}},{key:"cloneArray",value:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].clone());return e}},{key:"pointsToArray",value:function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n].x,t[n].y]);return e}}]),t}(),Vn=function(){function t(e,i){n(this,t),this.startPoint=e,this.endPoint=i}return r(t,[{key:"contains",value:function(t,e){if(Math.min(this.startPoint.x,this.endPoint.x)<=t&&t<=Math.max(this.startPoint.x,this.endPoint.x)&&Math.min(this.startPoint.y,this.endPoint.y)<=e&&e<=Math.max(this.startPoint.y,this.endPoint.y)){if(this.startPoint.x==this.endPoint.x)return t==this.startPoint.x;var n=(this.endPoint.y-this.startPoint.y)/(this.endPoint.x-this.startPoint.x);return e==n*t+(this.startPoint.y-n*this.startPoint.x)}return!1}},{key:"near",value:function(t,e,n){if(this.endPoint.x===this.startPoint.x)return(this.startPoint.y-n<=e&&this.endPoint.y+n>=e||this.endPoint.y-n<=e&&this.startPoint.y+n>=e)&&t>this.startPoint.x-n&&t<this.startPoint.x+n;if(this.startPoint.y===this.endPoint.y)return(this.startPoint.x-n<=t&&this.endPoint.x+n>=t||this.endPoint.x-n<=t&&this.startPoint.x+n>=t)&&e>this.startPoint.y-n&&e<this.startPoint.y+n;var i=Math.min(this.endPoint.x,this.startPoint.x),r=Math.min(this.endPoint.y,this.startPoint.y),o=Math.max(this.endPoint.x,this.startPoint.x),s=Math.max(this.endPoint.y,this.startPoint.y),a=this.endPoint.y-this.startPoint.y,h=this.startPoint.x-this.endPoint.x,u=-(this.startPoint.x*this.endPoint.y-this.endPoint.x*this.startPoint.y),l=Math.abs((a*t+h*e+u)/Math.sqrt(Math.pow(a,2)+Math.pow(h,2))),c=(h*(h*t-a*e)-a*u)/(Math.pow(a,2)+Math.pow(h,2)),f=(a*(-h*t+a*e)-h*u)/(Math.pow(a,2)+Math.pow(h,2));return l<=n&&o>=c&&c>=i&&s>=f&&f>=r||this.startPoint.near(t,e,n)||this.endPoint.near(t,e,n)}},{key:"getPoints",value:function(){var t=[];return t.push(this.startPoint),t.push(this.endPoint),t}},{key:"getPoint",value:function(t){var e=t*(this.endPoint.x-this.startPoint.x)+this.startPoint.x,n=t*(this.endPoint.y-this.startPoint.y)+this.startPoint.y;return new Fn(e,n)}},{key:"clone",value:function(){return new t(this.startPoint.clone(),this.endPoint.clone())}},{key:"equals",value:function(e){return e instanceof t&&(this.startPoint.equals(e.startPoint)&&this.endPoint.equals(e.endPoint))}},{key:"toString",value:function(){return"line("+this.startPoint+","+this.endPoint+")"}}],[{key:"load",value:function(e){return new t(Fn.load(e.startPoint),Fn.load(e.endPoint))}}]),t}(),$n=function(t){s(i,t);var e=c(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,i);var r=i.arrangeParam(t);return e.call(this,r)}return r(i,[{key:"calcLocalOrigin",value:function(){var t=new DOMPoint(0,0);return this.state.localOrigin=t,t}},{key:"calcDots",value:function(){var t=this,e=this.state.left,n=this.state.top;return this.state.dots=[],this.state.points.forEach((function(i){var r=i[0]-e,o=i[1]-n;t.state.dots.push(new DOMPoint(r,o))})),this.state.dots}},{key:"addDot",value:function(t,e){this.state.points.splice(e,0,t),this.state.dots.splice(e,0,new DOMPoint(t[0],t[1]))}},{key:"rmDot",value:function(t){return!(this.state.points.length<3)&&(this.state.points.splice(t,1),this.state.dots.splice(t,1),!0)}},{key:"calcOriginalDimension",value:function(){this.calcDots();var t=this.calc4VertexPoints(),e=Math.abs(t[1].x-t[0].x),n=this.state.style.lineWidth;return this.isDotsOnSameLine()?(this.state.width=e,this.state.height=n,{width:this.state.width,height:this.state.height}):(n=Math.abs(t[2].y-t[0].y),this.state.width=e,this.state.height=n,{width:this.state.width,height:this.state.height})}},{key:"isDotsOnSameLine",value:function(){for(var t=this.state.points.length,e=Rn(this.state.points[0][0],2),n=Rn(this.state.points[0][1],2),i=0,r=[Rn(this.state.points[t-1][0],2)-e,Rn(this.state.points[t-1][1],2)-n],o=0;o<t;o++){var s=this.state.points[o],a=[s[0]-e,s[1]-n];0===Tn.crossProduct(r[0],r[1],a[0],a[1])&&i++}return i===t}},{key:"calc4VertexPoints",value:function(){return this.isDotsOnSameLine()?this.splitEndpointsTo4Points():v(a(i.prototype),"calc4VertexPoints",this).call(this)}},{key:"splitEndpointsTo4Points",value:function(){var t=this.state.points.length,e=this.state.points[t-1][0]-this.state.points[0][0],n=this.state.points[t-1][1]-this.state.points[0][1],i=this.getRotateAngle(),r=this.state.height,o=Math.cos(i*Math.PI/180)*r/2,s=Math.sin(i*Math.PI/180)*r/2;return o=Rn(o,3),s=Rn(s,3),[new DOMPoint(0+o,0+s),new DOMPoint(0-o,0-s),new DOMPoint(e+o,n+s),new DOMPoint(e-o,n-s)]}},{key:"getMinBoundingBox",value:function(){var t=this.state.localOrigin.x,e=this.state.localOrigin.y,n=this.calc4VertexPoints(),i=new Nn([n[0].x-t,n[0].y-e,n[1].x-t,n[1].y-e,n[2].x-t,n[2].y-e,n[3].x-t,n[3].y-e,0,0]);return i=i.transform(this.state.composedMatrix)}},{key:"setState",value:function(t){if(Yn(t.width)||delete t.width,Yn(t.height)||delete t.height,Yn(t.transform)||delete t.transform,!Yn(t.left))for(var e=t.left-this.state.points[0][0],n=0;n<this.state.points.length;n++)this.state.points[n][0]+=e;if(!Yn(t.top))for(var r=t.top-this.state.points[0][1],o=0;o<this.state.points.length;o++)this.state.points[o][1]+=r;if(Yn(t.startPoint)||(this.state.points[0]=y(t.startPoint),this.state.left=this.state.points[0][0],this.state.top=this.state.points[0][1]),!Yn(t.endPoint)){var s=this.state.points.length;this.state.points[s-1]=y(t.endPoint)}v(a(i.prototype),"setState",this).call(this,t)}},{key:"getRotateAngle",value:function(){if(this.isDotsOnSameLine()){var t=this.state.points.length,e=this.state.points[t-1][0]-this.state.points[0][0],n=this.state.points[t-1][1]-this.state.points[0][1],r=Tn.calcRotateAngle(e,n,0,0);return r+=90}return v(a(i.prototype),"getRotateAngle",this).call(this)}}],[{key:"arrangeParam",value:function(t){var e=We({linkable:!1,lineType:"solid",lineWidth:2,arrow:"none",closePath:!1,points:[]},t),n=e.points.length;return n<2&&(0===n?(e.points.push([0,0]),e.points.push([10,10])):1===n&&e.points.push([10,10])),(e=We(e,{left:t.points[0][0],top:t.points[0][1],transform:{translate:[0,0],scale:[1,1],skew:[0,0],rotate:0}})).style.lineWidth<=0&&(e.style.lineWidth=2),e}}]),i}(Hn),Gn=function(t){s(i,t);var e=c(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,i),Yn(r.startPoint)&&(r.startPoint=[0,0]),Yn(r.endPoint)&&(r.endPoint=[10,10]),r.points=[r.startPoint,r.endPoint],r.linkable=!1,o(u(t=e.call(this,r)),"startComponent",void 0),o(u(t),"endComponent",void 0),o(u(t),"escapeDistance",30),t}return r(i,[{key:"calcDots",value:function(){var t=this,e=this.state.left,n=this.state.top,i=this.interpolate()[0][2];return this.state.points=[],this.state.dots=[],i.forEach((function(i){t.state.points.push([i.x,i.y]),t.state.dots.push(new DOMPoint(i.x-e,i.y-n))})),this.state.dots}},{key:"interpolate",value:function(){var t=this.state.points.length,e=this.state.points[0][0],n=this.state.points[0][1],i=this.state.points[t-1][0],r=this.state.points[t-1][1],o=new Fn(e,n),s=new Fn(i,r),a=[],h=null,u=null,l=[],c=new Nn,f=new Nn;if(this.startComponent){c=this.startComponent.getMinBoundingBox(),a[0]=new Fn(o.x,c.tl.y-this.escapeDistance),a[1]=new Fn(c.tr.x+this.escapeDistance,o.y),a[2]=new Fn(o.x,c.br.y+this.escapeDistance),a[3]=new Fn(c.tl.x-this.escapeDistance,o.y),h=a[0];for(var v=1;v<a.length;v++)this.distance(o,a[v])<this.distance(o,h)&&(h=a[v])}if(this.endComponent){f=this.endComponent.getMinBoundingBox(),a[0]=new Fn(s.x,f.tl.y-this.escapeDistance),a[1]=new Fn(f.tr.x+this.escapeDistance,s.y),a[2]=new Fn(s.x,f.br.y+this.escapeDistance),a[3]=new Fn(f.tl.x-this.escapeDistance,s.y),u=a[0];for(var d=1;d<a.length;d++)this.distance(s,a[d])<this.distance(s,u)&&(u=a[d])}var y=0,p=[o];h&&(p.push(h),y=1),u&&p.push(u),p.push(s);var g=Fn.cloneArray(p);l.push(["s0","s0",g]);var x=Fn.cloneArray(p),m=Fn.cloneArray(x);m.splice(y+1,0,new Fn(m[y].x,m[y+1].y)),l.push(["s1","s1_1",m]);var w=Fn.cloneArray(x);w.splice(y+1,0,new Fn(w[y+1].x,w[y].y)),l.push(["s1","s1_2",w]);var P=Fn.cloneArray(x),b=new Fn((P[y].x+P[y+1].x)/2,P[y].y),k=new Fn((P[y].x+P[y+1].x)/2,P[y+1].y);P.splice(y+1,0,b,k),l.push(["s2","s2_1",P]);var M=Fn.cloneArray(x),O=new Fn(M[y].x,(M[y].y+M[y+1].y)/2),C=new Fn(M[y+1].x,(M[y].y+M[y+1].y)/2);M.splice(y+1,0,O,C),l.push(["s2","s2_2",M]);var D=Fn.cloneArray(x),_=[D[y].x+20,D[y+1].x+20];c&&_.push(c.br.x+20),f&&_.push(f.br.x+20);var E=this.max(_),S=new Fn(E,D[y].y),j=new Fn(E,D[y+1].y);D.splice(y+1,0,S,j),l.push(["s2","s2_3",D]);var B=Fn.cloneArray(x),A=[B[y].y-20,B[y+1].y-20];c&&A.push(c.tl.y-20),f&&A.push(f.tl.y-20);var R=this.min(A),T=new Fn(B[y].x,R),N=new Fn(B[y+1].x,R);B.splice(y+1,0,T,N),l.push(["s2","s2_4",B]);var z=Fn.cloneArray(x),I=[z[y].x-20,z[y+1].x-20];c&&I.push(c.tl.x-20),f&&I.push(f.tl.x-20);var L=this.min(I),H=new Fn(L,z[y].y),q=new Fn(L,z[y+1].y);z.splice(y+1,0,H,q),l.push(["s2","s2_5",z]);var U=Fn.cloneArray(x),X=[U[y].y+20,U[y+1].y+20];c&&X.push(c.tl.y+c.height+20),f&&X.push(f.tl.y+f.height+20);var W=this.max(X),Y=new Fn(U[y].x,W),F=new Fn(U[y+1].x,W);U.splice(y+1,0,Y,F),l.push(["s2","s2_6",U]);for(var V=[],$=0;$<l.length;$++){var G=l[$][2];this.orthogonalPath(G)&&V.push(l[$])}if(l=V,!o.equals(s)){for(var J=[],K=0;K<l.length;K++){var Q=l[K][2];this.forwardPath(Q)&&J.push(l[K])}(l=J).length}for(var Z=[],tt=0;tt<l.length;tt++){var et=!1,nt=l[tt][2].slice();(f||c)&&(nt=nt.slice(1,nt.length-1)),c&&(et=et||this.polylineIntersectsRectangle(nt,c)),f&&(et=et||this.polylineIntersectsRectangle(nt,f)),et||Z.push(l[tt])}0!=Z.length&&(l=Z),l.length;for(var it=l[0][2].length,rt=[],ot=0;ot<l.length;ot++){l[ot][2].length==it&&rt.push(l[ot])}l=rt;for(var st=0,at=0;at<l.length;at++)this.scorePath(l[st][2])<this.scorePath(l[at][2])&&(st=at);return l=[l[st]]}},{key:"orthogonalPath",value:function(t){if(t.length<=1)return!0;for(var e=0;e<t.length-1;e++)if(t[e].x!=t[e+1].x&&t[e].y!=t[e+1].y)return!1;return!0}},{key:"lineIntersectsLine",value:function(t,e){if(t.startPoint.x==t.endPoint.x&&e.startPoint.x==e.endPoint.x)return t.startPoint.x==e.startPoint.x&&(t.contains(e.startPoint.x,e.startPoint.y)||t.contains(e.endPoint.x,e.endPoint.y));if(t.startPoint.x==t.endPoint.x||e.startPoint.x==e.endPoint.x){if(t.startPoint.x==t.endPoint.x){var n=t;t=e,e=n}var i=(t.endPoint.y-t.startPoint.y)/(t.endPoint.x-t.startPoint.x),r=t.startPoint.y-i*t.startPoint.x,o=e.startPoint.x,s=i*o+r;return t.contains(o,s)&&e.contains(o,s)}var a=(t.endPoint.y-t.startPoint.y)/(t.endPoint.x-t.startPoint.x),h=t.startPoint.y-a*t.startPoint.x,u=(e.endPoint.y-e.startPoint.y)/(e.endPoint.x-e.startPoint.x),l=e.startPoint.y-u*e.startPoint.x;if(a==u)return h==l&&(t.contains(e.startPoint.x,e.startPoint.y)||t.contains(e.endPoint.x,e.endPoint.y));var c=(l-h)/(a-u),f=a*c+h;return t.contains(c,f)&&e.contains(c,f)}},{key:"polylineIntersectsRectangle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[];i.push(new Vn(new Fn(e.x1,e.y1),new Fn(e.x2,e.y1))),i.push(new Vn(new Fn(e.x2,e.y1),new Fn(e.x2,e.y2))),i.push(new Vn(new Fn(e.x2,e.y2),new Fn(e.x1,e.y2))),i.push(new Vn(new Fn(e.x1,e.y2),new Fn(e.x1,e.y1)));for(var r=0;r<t.length-1;r++)for(var o=new Vn(t[r],t[r+1]),s=0;s<i.length;s++)if(this.lineIntersectsLine(o,i[s]))return!0;if(n)for(var a=new Vn(t[t.length-1],t[0]),h=0;h<i.length;h++)if(this.lineIntersectsLine(a,i[h]))return!0;return!1}},{key:"scorePath",value:function(t){if(t.length<=2)return-1;for(var e=0,n=1;n<t.length-1;n++)if(t[n-1].x==t[n].x&&t[n].x==t[n+1].x){if(this.signum(t[n+1].y-t[n].y)!=this.signum(t[n].y-t[n-1].y))return-1;e++}else if(t[n-1].y==t[n].y&&t[n].y==t[n+1].y){if(this.signum(t[n+1].x-t[n].x)!=this.signum(t[n].x-t[n-1].x))return-1;e++}else e--;return e}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"forwardPath",value:function(t){if(t.length<=2)return!0;for(var e=0;e<t.length-2;e++)if(t[e].x==t[e+1].x&&t[e+1].x==t[e+2].x){if(0!=this.signum(t[e+1].y-t[e].y)&&this.signum(t[e+1].y-t[e].y)==-1*this.signum(t[e+2].y-t[e+1].y))return!1}else if(t[e].y==t[e+1].y&&t[e+1].y==t[e+2].y&&0!=this.signum(t[e+1].x-t[e].x)&&this.signum(t[e+1].x-t[e].x)==-1*this.signum(t[e+2].x-t[e+1].x))return!1;return!0}},{key:"distance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}},{key:"max",value:function(t){if(0==t.lenght)return NaN;for(var e=t[0],n=0;n<t.length;n++)e<t[n]&&(e=t[n]);return e}},{key:"min",value:function(t){if(0==t.lenght)return NaN;for(var e=t[0],n=0;n<t.length;n++)e>t[n]&&(e=t[n]);return e}},{key:"addDot",value:function(t,e){throw new Error("Can NOT add dot to ICEVisioLink mannually.")}},{key:"rmDot",value:function(t){throw new Error("Can NOT remove dot from ICEVisioLink mannually.")}}]),i}($n),Jn=function(t){s(h,t);var i=c(h);function h(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,h);var s=We({},r);return s.style={strokeStyle:"#8b0000",fillStyle:"rgba(255, 255, 49, 0.2)",lineWidth:1},o(u(t=i.call(this,s)),"startHook",void 0),o(u(t),"endHook",void 0),o(u(t),"hookRadius",10),t.addChild(new Gn(e({},r))),t.createLinkHooks(),t}return r(h,[{key:"initEvents",value:function(){v(a(h.prototype),"initEvents",this).call(this)}},{key:"renderChildren",value:function(){this.setHookPositions(),v(a(h.prototype),"renderChildren",this).call(this)}}]),h}(Xn);Ye(Jn,[Wn]);var Kn=function(t){s(r,t);var i=c(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,r);var o=e({radius:10},t);return o.radiusX=o.radius,o.radiusY=o.radius,i.call(this,o)}return r}(function(t){s(o,t);var i=c(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,o);var r=e({radiusX:20,radiusY:10,rotation:0,startAngle:0,endAngle:2*Math.PI,counterclockwise:!0},t);return r.width=2*r.radiusX,r.height=2*r.radiusY,i.call(this,r)}return r(o,[{key:"createPathObject",value:function(){return this.path2D=new Path2D,this.path2D.ellipse(this.state.radiusX-this.state.localOrigin.x,this.state.radiusY-this.state.localOrigin.y,this.state.radiusX,this.state.radiusY,this.state.rotation,this.state.startAngle,this.state.endAngle,this.state.counterclockwise),this.path2D.closePath(),this.path2D}},{key:"setState",value:function(t){Yn(t.radiusX)?Yn(t.width)||(t.radiusX=t.width/2):t.width=2*t.radiusX,Yn(t.radiusY)?Yn(t.height)||(t.radiusY=t.height/2):t.height=2*t.radiusY,v(a(o.prototype),"setState",this).call(this,t)}}]),o}(Ln)),Qn=function(){function t(){n(this,t),o(this,"hostComponent",void 0)}return r(t,[{key:"hostMoveHandler",value:function(t){console.log("host moving...")}},{key:"setHostComponent",value:function(t){this.hostComponent=t,this.hostComponent?this.hostComponent.on("after-move",this.hostMoveHandler,this):this.hostComponent.off("after-move",this.hostMoveHandler,this)}}]),t}(),Zn=function(t){s(h,t);var i=c(h);function h(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,h),o(u(t=i.call(this,e({linkable:!1,position:"T"},r))),"hostComponent",void 0),t}return r(h,[{key:"initEvents",value:function(){v(a(h.prototype),"initEvents",this).call(this),this.on("mouseover",this.mouseOverHandler,this),this.on("mouseup",this.mosueUpHandler,this),this.once(Ve,this.afterAddHandler,this),this.once(Ke,this.beforeRemoveHandler,this)}},{key:"afterAddHandler",value:function(t){this.evtBus.on("hook-mousedown",this.hookMouseDownHandler,this),this.evtBus.on("hook-mouseup",this.hookMouseUpHandler,this)}},{key:"beforeRemoveHandler",value:function(t){this.evtBus.off("hook-mousedown",this.hookMouseDownHandler,this),this.evtBus.off("hook-mouseup",this.hookMouseUpHandler,this)}},{key:"hookMouseDownHandler",value:function(t){this.setState({display:!0})}},{key:"hookMouseUpHandler",value:function(t){var e=this.getMaxBoundingBox(),n=t.target.getMaxBoundingBox();e.isIntersect(n)&&console.log("存在交叉部分，建立连接关系..."),this.setState({display:!1})}},{key:"mouseOverHandler",value:function(t){console.log("mouse over...")}},{key:"mosueUpHandler",value:function(t){console.log("mouse up...")}}]),h}(Kn);Ye(Zn,[Qn]);var ti=function(){function t(){n(this,t),o(this,"linkSlots",[]),o(this,"slotRadius",10)}return r(t,[{key:"createLinkSlots",value:function(){var t=new Zn({display:!1,transformable:!1,radius:this.slotRadius,position:"T",style:{strokeStyle:"#0c09d4",fillStyle:"#3ce92c",lineWidth:1}}),e=new Zn({display:!1,transformable:!1,radius:this.slotRadius,position:"R",style:{strokeStyle:"#0c09d4",fillStyle:"#3ce92c",lineWidth:1}}),n=new Zn({display:!1,transformable:!1,radius:this.slotRadius,position:"B",style:{strokeStyle:"#0c09d4",fillStyle:"#3ce92c",lineWidth:1}}),i=new Zn({display:!1,transformable:!1,radius:this.slotRadius,position:"L",style:{strokeStyle:"#0c09d4",fillStyle:"#3ce92c",lineWidth:1}});this.linkSlots=[t,e,n,i],this.addChildren([t,e,n,i])}},{key:"setSlotPositions",value:function(){var t=this.state.width,e=this.state.height,n=t/2,i=e/2,r={T:{left:n-this.slotRadius,top:-this.slotRadius},R:{left:t-this.slotRadius,top:i-this.slotRadius},B:{left:n-this.slotRadius,top:e-this.slotRadius},L:{left:-this.slotRadius,top:i-this.slotRadius}};this.linkSlots.forEach((function(t){var e=r[t.state.position],n=e.left,i=e.top;t.setState({left:n,top:i})}))}}]),t}(),ei=function(t){s(i,t);var e=c(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,i);var s=We({},r);s.width=2*s.radius,s.height=2*s.radius,s.style={strokeStyle:"#8b0000",fillStyle:"rgba(255, 255, 49, 0.2)",lineWidth:1},o(u(t=e.call(this,s)),"linkSlots",[]),o(u(t),"slotRadius",10);var a=r.radius,h=r.style;return t.addChild(new Kn({radius:a,style:h,interactive:!1})),t.createLinkSlots(),t}return r(i,[{key:"renderChildren",value:function(){this.setSlotPositions(),v(a(i.prototype),"renderChildren",this).call(this)}}]),i}(Xn);Ye(ei,[ti]);var ni=function(t){s(i,t);var e=c(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,i);var s=We({},r);s.style={strokeStyle:"#8b0000",fillStyle:"rgba(255, 255, 49, 0.2)",lineWidth:1},o(u(t=e.call(this,s)),"linkSlots",[]),o(u(t),"slotRadius",10);var a=r.width,h=r.height,l=r.style;return t.addChild(new qn({width:a,height:h,style:l,interactive:!1})),t.createLinkSlots(),t}return r(i,[{key:"renderChildren",value:function(){this.setSlotPositions(),v(a(i.prototype),"renderChildren",this).call(this)}}]),i}(Xn);Ye(ni,[ti]);var ii=function(t){return"string"==typeof t||!te(t)&&$t(t)&&"[object String]"==F(t)},ri="0.0.1",oi=function(){function t(e){n(this,t),o(this,"ice",void 0),o(this,"currentObj",void 0),this.ice=e}return r(t,[{key:"mouseDownHandler",value:function(t){var e=t.target;e.state.interactive&&e.state.draggable&&(this.currentObj=e,this.ice.evtBus.on("mousemove",this.mouseMoveHandler,this),this.ice.evtBus.on("mouseup",this.mouseUpHandler,this))}},{key:"mouseMoveHandler",value:function(t){var e=t.movementX/window.devicePixelRatio,n=t.movementY/window.devicePixelRatio;return this.currentObj.moveGlobalPosition(e,n,t),!0}},{key:"mouseUpHandler",value:function(t){this.ice.evtBus.off("mousemove",this.mouseMoveHandler,this),this.ice.evtBus.off("mouseup",this.mouseUpHandler,this)}},{key:"start",value:function(){return this.ice.evtBus.on("mousedown",this.mouseDownHandler,this),this}},{key:"stop",value:function(){}}]),t}(),si=function(t){s(i,t);var e=c(i);function i(t){var r;return n(this,i),o(u(r=e.call(this,t)),"_targetComponent",void 0),r}return r(i,[{key:"renderChildren",value:function(){this.setControlPositions(),v(a(i.prototype),"renderChildren",this).call(this)}},{key:"moveGlobalPosition",value:function(t,e,n){v(a(i.prototype),"moveGlobalPosition",this).call(this,t,e,n),this._targetComponent&&this._targetComponent.moveGlobalPosition(t,e,n)}}]),i}(Un),ai=function(t){s(o,t);var i=c(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,o),i.call(this,e({linkable:!1},t))}return r(o,[{key:"initEvents",value:function(){v(a(o.prototype),"initEvents",this).call(this),this.on("mousedown",this.mosueDownHandler,this),this.on("mouseup",this.mosueUpHandler,this),this.on("after-move",this.resizeEvtHandler,this)}},{key:"mosueDownHandler",value:function(t){this.evtBus.trigger("hook-mousedown",new mn({target:this}))}},{key:"mosueUpHandler",value:function(t){this.evtBus.trigger("hook-mouseup",new mn({target:this}))}},{key:"resizeEvtHandler",value:function(t){if(this.parentNode){var e=this.props.position;this.parentNode.trigger("before-resize",new mn(t,{position:e})),this.parentNode.trigger("after-resize",new mn(t,{position:e}))}}}]),o}(Kn),hi=function(t){s(a,t);var i=c(a);function a(t){var r;return n(this,a),o(u(r=i.call(this,e(e({},t),{},{zIndex:Number.MAX_VALUE}))),"controlSize",16),o(u(r),"startControl",void 0),o(u(r),"endControl",void 0),r.initControls(),r}return r(a,[{key:"initControls",value:function(){var t=1,e=this.state.width,n=this.state.height,i=this.controlSize/2;this.startControl=new ai({zIndex:Number.MAX_VALUE-t++,left:-i,top:-i,width:this.controlSize,height:this.controlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:"start"}),this.addChild(this.startControl),this.endControl=new ai({zIndex:Number.MAX_VALUE-t++,left:e-i,top:n-i,width:this.controlSize,height:this.controlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},position:"end"}),this.addChild(this.endControl)}},{key:"initEvents",value:function(){this.on("after-resize",this.resizeEvtHandler,this)}},{key:"setControlPositions",value:function(){}},{key:"resizeEvtHandler",value:function(t){if(this.targetComponent){var e=t.position,n=t.movementX/window.devicePixelRatio,i=t.movementY/window.devicePixelRatio,r=this.targetComponent.state,o=r.points.length,s=r.points[0][0],a=r.points[0][1],h=r.points[o-1][0],u=r.points[o-1][1],l=r.absoluteLinearMatrix.inverse(),c=new DOMPoint(n,i).matrixTransform(l);switch(n=c.x,i=c.y,e){case"start":s+=n,a+=i;break;case"end":h+=n,u+=i}this.targetComponent.setState({startPoint:[s,a],endPoint:[h,u]})}}},{key:"updatePosition",value:function(){if(this.targetComponent){this.setState({left:0,top:0,width:100,height:100,transform:{translate:[0,0],scale:[1,1],skew:[0,0],rotate:0}});var t=this.controlSize/2,e=this.targetComponent.state.points.length,n=this.targetComponent.state.points[0],i=this.targetComponent.state.points[e-1],r=new DOMPoint(n[0],n[1]),o=new DOMPoint(i[0],i[1]);this.startControl.setState({left:r.x-t,top:r.y-t}),this.endControl.setState({left:o.x-t,top:o.y-t})}}},{key:"followTargetComponent",value:function(t){this.updatePosition()}},{key:"targetComponent",get:function(){return this._targetComponent},set:function(t){this._targetComponent=t,t?(this.updatePosition(),t.on("after-move",this.followTargetComponent,this)):t.off("after-move",this.followTargetComponent,this)}}]),a}(si),ui=function(t){s(o,t);var i=c(o);function o(t){var r;return n(this,o),(r=i.call(this,e({position:"l",direction:"x",quadrant:1},t))).on("after-move",r.resizeEvtHandler,u(r)),r}return r(o,[{key:"resizeEvtHandler",value:function(t){if(this.parentNode){var e=t.quadrant,n=t.movementX/window.devicePixelRatio,i=t.movementY/window.devicePixelRatio,r=this.parentNode.state,o=r.left,s=r.top,a=r.width,h=r.height,u=r.absoluteLinearMatrix.inverse(),l=new DOMPoint(n,i).matrixTransform(u);switch(n=l.x,i=l.y,e){case 1:o-=n,s+=i,a+=2*n,h-=2*i;break;case 2:o+=n,s+=i,a-=2*n,h-=2*i;break;case 3:o+=n,s-=i,a-=2*n,h+=2*i;break;case 4:o-=n,s-=i,a+=2*n,h+=2*i;break;case 5:s+=i,h-=2*i;break;case 6:s-=i,h+=2*i;break;case 7:o+=n,a-=2*n;break;case 8:o-=n,a+=2*n}var c={top:s,left:o,width:Math.abs(a),height:Math.abs(h)};this.parentNode.trigger("before-resize",new mn(t,{quadrant:e})),this.parentNode.setState(c),this.parentNode.trigger("after-resize",new mn(t,{quadrant:e}))}}},{key:"moveGlobalPosition",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mn,i=t>0?1:-1,r=e>0?1:-1,o=this.parentNode.state,s=o.localOrigin,a=o.width,h=o.height,u=o.absoluteLinearMatrix.inverse(),l=new DOMPoint(t,e).matrixTransform(u);t=l.x,e=l.y;var c=this.state,f=c.left,v=c.top,d=c.quadrant,y=this.state.width/2,p=0;if("x"===this.state.direction)0===Rn(f+=t)&&(f=.5*i),p=f+y-s.x>0?8:7;else if("y"===this.state.direction)0===Rn(v+=e)&&(v=.5*r),p=v+y-s.y>0?6:5;else if("xy"===this.state.direction){var g=-a/2;0===Rn(g)&&(g=.5*i);var x=-h/2,m=x/g,w=a/2;0===Rn(w)&&(w=.5*i);var P=-h/2,b=P/w;v+=e=2===d||4==d?m*(f+y-s.x+t)-(v+y-s.y):b*(f+y-s.x+t)-(v+y-s.y),p=(f+=t)+y-s.x>0?v+y-s.y>0?4:1:v+y-s.y>0?3:2}var k=d!==p;k&&this.parentNode.toggleControlQuadrant(this,p),this.setPosition(f,v,new mn(n,{left:f,top:v,tx:t,ty:e,quadrant:p}))}}]),o}(qn),li=function(t){s(i,t);var e=c(i);function i(t){var r;return n(this,i),(r=e.call(this,t)).on("after-move",r.rotateEvtHandler,u(r)),r}return r(i,[{key:"rotateEvtHandler",value:function(t){if(this.parentNode){var e=this.parentNode.state.absoluteOrigin,n={transform:{rotate:Tn.calcRotateAngle(t.offsetX,t.offsetY,e.x,e.y)+90}};this.parentNode.trigger("before-rotate",new mn(n)),this.parentNode.setState(n),this.parentNode.trigger("after-rotate",new mn(n))}}}]),i}(Kn),ci=function(t){s(a,t);var i=c(a);function a(t){var r;return n(this,a),o(u(r=i.call(this,e(e({},t),{},{zIndex:Number.MAX_VALUE}))),"rotateControlInstance",void 0),o(u(r),"rotateControlSize",8),o(u(r),"rotateControlffsetY",60),o(u(r),"resizeControlInstanceCache",[]),o(u(r),"resizeControlSize",16),r.initControls(),r}return r(a,[{key:"initControls",value:function(){var t=this,e=this.state.width,n=this.state.height,i=e/2,r=n/2,o=this.resizeControlSize/2,s=[{direction:"xy",quadrant:2,position:new DOMPoint(-o,-o)},{direction:"y",quadrant:5,position:new DOMPoint(i-o,-o)},{direction:"xy",quadrant:1,position:new DOMPoint(e-o,-o)},{direction:"x",quadrant:8,position:new DOMPoint(e-o,r-o)},{direction:"xy",quadrant:4,position:new DOMPoint(e-o,n-o)},{direction:"y",quadrant:6,position:new DOMPoint(i-o,n-o)},{direction:"xy",quadrant:3,position:new DOMPoint(-o,n-o)},{direction:"x",quadrant:7,position:new DOMPoint(-o,r-o)}],a=1;this.resizeControlInstanceCache=[],s.forEach((function(e){var n=new ui({zIndex:Number.MAX_VALUE-a++,left:e.position.x,top:e.position.y,width:t.resizeControlSize,height:t.resizeControlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1},direction:e.direction,quadrant:e.quadrant});t.addChild(n),t.resizeControlInstanceCache.push(n)}));var h=this.state.width/2-this.rotateControlSize,u=-this.rotateControlffsetY;this.rotateControlInstance=new li({zIndex:Number.MAX_VALUE-a++,left:h,top:u,radius:this.rotateControlSize,style:{strokeStyle:"#8b0000",fillStyle:"#CC3300",lineWidth:1}}),this.addChild(this.rotateControlInstance)}},{key:"initEvents",value:function(){this.on("after-resize",this.resizeEvtHandler,this),this.on("after-rotate",this.rotateEvtHandler,this)}},{key:"setControlPositions",value:function(){var t=this.state.width,e=this.state.height,n=t/2,i=e/2,r=this.resizeControlSize/2;this.resizeControlInstanceCache.forEach((function(o){var s=o.state.quadrant,a=new DOMPoint;switch(s){case 1:a=new DOMPoint(t-r,-r);break;case 2:a=new DOMPoint(-r,-r);break;case 3:a=new DOMPoint(-r,e-r);break;case 4:a=new DOMPoint(t-r,e-r);break;case 5:a=new DOMPoint(n-r,-r);break;case 6:a=new DOMPoint(n-r,e-r);break;case 7:a=new DOMPoint(-r,i-r);break;case 8:a=new DOMPoint(t-r,i-r)}o.setState({left:a.x,top:a.y})}));var o=this.state.width/2-this.rotateControlSize,s=-this.rotateControlffsetY;this.rotateControlInstance.setState({left:o,top:s})}},{key:"rotateEvtHandler",value:function(t){if(this.targetComponent){var e=this.state.transform.rotate;this.targetComponent.setGlobalRotate(e)}}},{key:"resizeEvtHandler",value:function(t){if(this.targetComponent){var e=t.quadrant,n=t.movementX/window.devicePixelRatio,i=t.movementY/window.devicePixelRatio,r=this.targetComponent.state,o=r.left,s=r.top,a=r.width,h=r.height,u=r.absoluteLinearMatrix.inverse(),l=new DOMPoint(n,i).matrixTransform(u);switch(n=l.x,i=l.y,e){case 1:o-=n,s+=i,a+=2*n,h-=2*i;break;case 2:o+=n,s+=i,a-=2*n,h-=2*i;break;case 3:o+=n,s-=i,a-=2*n,h+=2*i;break;case 4:o-=n,s-=i,a+=2*n,h+=2*i;break;case 5:s+=i,h-=2*i;break;case 6:s-=i,h+=2*i;break;case 7:o+=n,a-=2*n;break;case 8:o-=n,a+=2*n}this.targetComponent.setState({left:o,top:s,width:Math.abs(a),height:Math.abs(h)})}}},{key:"updatePosition",value:function(){if(this.targetComponent){var t=this.targetComponent.getRotateAngle(),e=this.targetComponent.getLocalLeftTop(),n=e.left,i=e.top,r=e.width,o=e.height;this.setState({left:n,top:i,width:r,height:o,transform:{rotate:t}})}}},{key:"followTargetComponent",value:function(t){this.updatePosition()}},{key:"targetComponent",get:function(){return this._targetComponent},set:function(t){this._targetComponent=t,t?(this.updatePosition(),t.on("after-move",this.followTargetComponent,this)):t.off("after-move",this.followTargetComponent,this)}},{key:"toggleControlQuadrant",value:function(t,e){this.resizeControlInstanceCache.forEach((function(t){if(t.state.quadrant===e){var n=0;switch(e){case 1:n=3;break;case 2:n=4;break;case 3:n=1;break;case 4:n=2;break;case 5:n=6;break;case 6:n=5;break;case 7:n=8;break;case 8:n=7}t.setState({quadrant:n})}})),t.setState({quadrant:e})}}]),a}(si),fi=function(){function t(e){n(this,t),o(this,"ice",void 0),o(this,"transformControlPanel",void 0),o(this,"lineControlPanel",void 0),this.ice=e,this.transformControlPanel=new ci({left:500,top:100,width:100,height:100,style:{strokeStyle:"#8b0000",fillStyle:"rgba(255, 255, 49, 0.2)",lineWidth:1},transform:{rotate:45}}),this.ice.addChild(this.transformControlPanel),this.lineControlPanel=new hi({left:700,top:50,width:100,height:100,style:{strokeStyle:"rgba(255, 255, 49, 0)",fillStyle:"rgba(255, 255, 49, 0)",lineWidth:1}}),this.ice.addChild(this.lineControlPanel)}return r(t,[{key:"mouseDownHandler",value:function(t){var e=t.target;if(!e.state.interactive||!e.state.transformable)return this.ice.removeChild(this.transformControlPanel),void this.ice.removeChild(this.lineControlPanel);e&&(e instanceof si||e.parentNode instanceof si)||(t.ctrlKey?this.ice.selectionList.push(e):this.ice.selectionList=[e],e instanceof $n?this.lineControlPanel.targetComponent=e:this.transformControlPanel.targetComponent=e)}},{key:"start",value:function(){return this.ice.evtBus.on("mousedown",this.mouseDownHandler,this),this}},{key:"stop",value:function(){}}]),t}();var vi=function(t){return void 0===t},di={linear:function(t,e,n,i){return t+(e-t)/n*(Date.now()-i)},easeInQuad:function(t,e,n,i){var r=Date.now()-i;return t+(e-t)/n*(r/n)*r}},yi=function(){function t(e){n(this,t),o(this,"animationMap",new Map),o(this,"ice",void 0),this.ice=e}return r(t,[{key:"start",value:function(){var t=this;return this.ice.evtBus.on(Fe,(function(e){t.animationMap.forEach((function(e){e.state.interactive=!1,t.tween(e),e.state.interactive=!0}))})),this}},{key:"tween",value:function(t){var n={},i=t.props.animations,r=1;for(var o in i){var s=i[o];if(s.finished){if(++r===Object.keys(i).length){this.remove(t);break}}else{var a=s.from,h=s.to,u=s.duration;vi(s.startTime)&&(s.startTime=Date.now()),vi(s.easing)&&(s.easing="linear");var l=di[s.easing](a,h,u,s.startTime);l>h&&(l=h,s.finished=!0),n[o]=Math.floor(l)}}return t.setState(e({},n)),t}},{key:"add",value:function(t){this.animationMap.set(t.props.id,t)}},{key:"remove",value:function(t){ii(t)?this.animationMap.delete(t):this.animationMap.delete(t.props.id)}},{key:"stop",value:function(){}}]),t}(),pi={evtBuses:[],frameCallback:function(){pi.evtBuses.forEach((function(t){t.trigger(Fe)})),xn.requestAnimationFrame(pi.frameCallback)},start:function(){xn.requestAnimationFrame(pi.frameCallback)},stop:function(){},pause:function(){},resume:function(){},regitserEvtBus:function(t){pi.evtBuses.includes(t)||pi.evtBuses.push(t)},delEvtBus:function(t){pi.evtBuses.includes(t)&&pi.evtBuses.splice(pi.evtBuses.indexOf(t),1)}},gi=[["click","ICE_CLICK"],["dbclick","ICE_DBCLICK"],["mousedown","ICE_MOUSEDOWN"],["mouseup","ICE_MOUSEUP"],["mousemove","ICE_MOUSEMOVE"],["mouseenter","ICE_MOUSEENTER"],["mouseleave","ICE_MOUSELEAVE"],["mouseout","ICE_MOUSEOUT"],["mouseover","ICE_MOUSEOVER"],["contextmenu","ICE_CONTEXTMENU"],["mousewheel","ICE_MOUSEWHEEL"]],xi=function(){function t(e){n(this,t),o(this,"selectionCandidates",[]),o(this,"ice",void 0),this.ice=e}return r(t,[{key:"start",value:function(){var t=this;return gi.forEach((function(e){t.ice.evtBus.on(e[1],(function(n){var i=t.findTargetComponent(n.clientX,n.clientY);i&&(n.target=i,i.trigger(e[0],n)),t.ice.evtBus.trigger(e[0],n)}))})),this}},{key:"findTargetComponent",value:function(t,e){for(var n=t-this.ice.canvasBoundingClientRect.left,i=e-this.ice.canvasBoundingClientRect.top,r=Array.from(this.ice.displayMap.values()),o=0;o<r.length;o++){var s=r[o];this.traverse(n,i,s)}this.selectionCandidates.sort((function(t,e){return t.zIndex-e.zIndex}));var a=this.selectionCandidates[0];return this.selectionCandidates=[],a}},{key:"traverse",value:function(t,e,n){var i=this;n.childNodes&&n.childNodes.length&&n.childNodes.forEach((function(n){i.traverse(t,e,n)})),n.getMinBoundingBox().containsPoint(new DOMPoint(t,e))&&n.state.interactive&&this.selectionCandidates.push(n)}}]),t}(),mi=function(t){s(i,t);var e=c(i);function i(){return n(this,i),e.call(this)}return i}(wn),wi={evtBuses:[],start:function(){xn&&xn&&xn.addEventListener&&wi.evtBuses.forEach((function(t){gi.forEach((function(e){xn.addEventListener(e[0],(function(n){t.trigger(e[1],n)}))}))}))},regitserEvtBus:function(t){wi.evtBuses.includes(t)||wi.evtBuses.push(t)},delEvtBus:function(t){wi.evtBuses.includes(t)&&wi.evtBuses.splice(wi.evtBuses.indexOf(t),1)}},Pi=function(){function t(e){n(this,t),o(this,"ice",void 0),this.ice=e}return r(t,[{key:"start",value:function(){var t=this;return this.ice.evtBus.on(Fe,(function(e){if(t.ice.ctx.clearRect(0,0,t.ice.canvasWidth,t.ice.canvasHeight),t.ice.displayMap&&t.ice.displayMap.size){var n=Array.from(t.ice.displayMap,(function(t){var e=d(t,2);e[0];return e[1]}));n.sort((function(t,e){return t.state.zIndex-e.state.zIndex})),n.forEach((function(t){t.trigger(Ve),t.state.isRendering||t.state.display&&(t.render(),t.trigger($e))}))}})),this}},{key:"stop",value:function(){throw new Error("Method not implemented.")}}]),t}();let bi=(new(function(){function t(){n(this,t),o(this,"version",ri),o(this,"displayMap",new Map),o(this,"evtBus",void 0),o(this,"root",void 0),o(this,"canvasEl",void 0),o(this,"ctx",void 0),o(this,"canvasWidth",0),o(this,"canvasHeight",0),o(this,"canvasBoundingClientRect",void 0),o(this,"selectionList",[]),o(this,"animationManager",void 0),o(this,"eventBridge",void 0),o(this,"ddManager",void 0),o(this,"controlPanelManager",void 0),o(this,"renderer",void 0)}return r(t,[{key:"init",value:function(t){if(!t)throw new Error("ICE.init() failed...");if(this.ctx===t)throw new Error("同一个 canvas 实例只能 init 一次...");return this.root=xn,ii(t)?(this.canvasEl=this.root.document.getElementById(t),this.canvasEl.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.canvasWidth=this.canvasEl.width,this.canvasHeight=this.canvasEl.height,this.canvasBoundingClientRect=this.canvasEl.getBoundingClientRect(),this.ctx=this.canvasEl.getContext("2d")):this.ctx=t,this.evtBus=new mi,pi.regitserEvtBus(this.evtBus),pi.start(),wi.regitserEvtBus(this.evtBus),wi.start(),this.animationManager=new yi(this).start(),this.eventBridge=new xi(this).start(),this.ddManager=new oi(this).start(),this.controlPanelManager=new fi(this).start(),this.renderer=new Pi(this).start(),this}},{key:"addChild",value:function(t){t.trigger(Ge),t.root=this.root,t.ctx=this.ctx,t.evtBus=this.evtBus,this.displayMap.set(t.props.id,t),Object.keys(t.props.animations).length&&this.animationManager.add(t),t.trigger(Je)}},{key:"addChildren",value:function(t){var e=this;t.forEach((function(t){e.addChild(t)}))}},{key:"removeChild",value:function(t){t.trigger(Ke),this.displayMap.delete(t.props.id),t.ctx=null,t.root=null,t.evtBus=null,t.trigger(Qe)}},{key:"removeChildren",value:function(t){var e=this;t.forEach((function(t){e.removeChild(t)}))}},{key:"clearRenderMap",value:function(){}},{key:"toJSON",value:function(){return"{}"}},{key:"fromJSON",value:function(t){return{}}},{key:"destory",value:function(){}}]),t}())).init("canvas-1"),ki=new Jn({left:0,top:0,width:100,height:100,startPoint:[500,500],endPoint:[700,700],style:{strokeStyle:"#7803e6",fillStyle:"#008000",lineWidth:5}});bi.addChild(ki);let Mi=new ni({left:100,top:100,width:300,height:200,style:{strokeStyle:"#0c09d4",fillStyle:"#f5d106",lineWidth:5},transform:{rotate:45}});bi.addChild(Mi);let Oi=new ei({left:200,top:500,radius:100});bi.addChild(Oi)}));
